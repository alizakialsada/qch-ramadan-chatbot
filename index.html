<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qatif Central Hospital â€“ Smart Ramadan Medication Assistant</title>
  <style>
    :root{
      --bg:#0b1f26; --card:#102b34; --card2:#0f2630; --text:#eaf6fb; --muted:#b7d2dd;
      --accent:#35d0c7; --accent2:#2aa6ff; --danger:#ff4d4f; --warn:#f5a524; --ok:#22c55e;
      --radius:18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
    }
    body{ margin:0; background:radial-gradient(1200px 700px at 20% 10%, #15404d 0%, var(--bg) 55%); color:var(--text); }
    .wrap{ max-width:1100px; margin:24px auto; padding:16px; }
    .top{
      background:linear-gradient(135deg,#123747,#0d2a34);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 18px;
      display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{ display:flex; gap:14px; align-items:center; }
    .logo{
      width:54px; height:54px; border-radius:16px;
      background:linear-gradient(135deg,var(--accent2),var(--accent));
      display:grid; place-items:center; font-weight:800;
      box-shadow:0 10px 20px rgba(0,0,0,.25);
    }
    .title h1{ margin:0; font-size:18px; letter-spacing:.2px;}
    .title p{ margin:4px 0 0; color:var(--muted); font-size:13px;}
    .controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    select, button{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      cursor:pointer;
      font-size:13px;
    }
    button{ background:rgba(53,208,199,.14); border-color:rgba(53,208,199,.35); }
    button:hover{ filter:brightness(1.05); }
    .grid{ margin-top:16px; display:grid; grid-template-columns: 1.3fr .9fr; gap:16px; }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      min-height:520px;
      display:flex; flex-direction:column;
    }
    .card header{
      padding:14px 16px;
      background:rgba(0,0,0,.15);
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .card header .h{ font-weight:700; }
    .badge{ font-size:12px; color:var(--muted); padding:6px 10px; border:1px solid rgba(255,255,255,.12); border-radius:999px; }
    .chatlog{
      padding:16px;
      overflow:auto;
      flex:1;
      -webkit-overflow-scrolling:touch;
    }
    .msg{ display:flex; margin:10px 0; }
    .msg .bubble{
      max-width:85%;
      padding:12px 12px;
      border-radius:16px;
      line-height:1.35;
      font-size:14px;
      border:1px solid rgba(255,255,255,.10);
      white-space:pre-wrap;
    }
    .me{ justify-content:flex-end; }
    .me .bubble{ background:rgba(53,208,199,.16); border-color:rgba(53,208,199,.35); }
    .bot .bubble{ background:rgba(255,255,255,.06); }
    .composer{
      position:sticky; bottom:0; z-index:50;
      display:flex; gap:10px; padding:12px;
      background:rgba(8,18,22,.7);
      border-top:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
    }
    .composer input{
      flex:1;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      outline:none;
      font-size:14px;
      pointer-events:auto;
    }
    .pillrow{ display:flex; flex-wrap:wrap; gap:8px; padding:14px 16px 0; }
    .pill{
      font-size:12px; color:var(--text);
      padding:8px 10px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      cursor:pointer;
      user-select:none;
    }
    .pill:hover{ border-color:rgba(53,208,199,.45); }
    .side{ min-height:520px; }
    .side .content{ padding:16px; color:var(--muted); font-size:13px; line-height:1.45;}
    .alert{ margin-top:10px; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05); }
    .danger{ border-color:rgba(255,77,79,.45); }
    .warn{ border-color:rgba(245,165,36,.45); }
    .ok{ border-color:rgba(34,197,94,.45); }
    .foot{ margin-top:14px; font-size:12px; color:rgba(234,246,251,.75); }
    a{ color:var(--accent); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">QCH</div>
        <div class="title">
          <h1>Qatif Central Hospital â€“ Smart Ramadan Medication Assistant</h1>
          <p>Pharmacy Department â€¢ Patient-focused â€¢ Arabic / English</p>
        </div>
      </div>
      <div class="controls">
        <select id="lang">
          <option value="bi" selected>Arabic + English</option>
          <option value="ar">Arabic</option>
          <option value="en">English</option>
        </select>
        <select id="mode">
          <option value="patient" selected>Patient</option>
          <option value="hcp">Healthcare Staff</option>
        </select>
        <button id="reset" type="button">Reset</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <header>
          <div class="h">Chat</div>
          <div class="badge" id="ver">Ramadan â€¢ v4 (Offline safe)</div>
        </header>

        <div class="pillrow" id="quick"></div>

        <div class="chatlog" id="chat"></div>

        <div class="composer">
          <input id="input" type="text" inputmode="text" autocapitalize="off" autocorrect="off"
                 placeholder="Type medication nameâ€¦ / Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡â€¦" autocomplete="off" />
          <button id="send" type="button">Send</button>
        </div>
      </section>

      <aside class="card side">
        <header>
          <div class="h">Safety & Quick Notes</div>
          <div class="badge">No PHI stored</div>
        </header>
        <div class="content" id="safety">
          <div class="alert warn">
            <b>Important:</b> This assistant provides <b>general guidance</b> and does not replace your doctor or pharmacist.
            If you have <b>pregnancy</b>, <b>kidney/liver disease</b>, <b>insulin use</b>, <b>warfarin</b>, transplant, or complex regimens,
            consult a healthcare professional before changing doses.
          </div>

          <div class="alert ok" id="welcomeBox"></div>

          <div class="foot">
            Created by <b>Ali Alsada</b><br/>
            Pharmacy Department â€¢ QCH
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
(() => {
  const ui = {
    lang: document.getElementById('lang'),
    mode: document.getElementById('mode'),
    reset: document.getElementById('reset'),
    chat: document.getElementById('chat'),
    input: document.getElementById('input'),
    send: document.getElementById('send'),
    quick: document.getElementById('quick'),
    welcomeBox: document.getElementById('welcomeBox'),
  };

  const meds = [
    { keys:["warfarin","coumadin","ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†","ÙƒÙˆÙ…Ø§Ø¯ÙŠÙ†"],
      cat:{ar:"Ù…Ø¶Ø§Ø¯ ØªØ®Ø«Ø±",en:"Anticoagulant"},
      patient:{ar:"âœ… Ø®Ø°Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§.\nâ›” Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¬Ø±Ø¹Ø©.\nðŸ“Œ Ø±Ø§Ù‚Ø¨ INR Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©.",en:"âœ… Take after Iftar at the same time daily.\nâ›” Do not adjust dose.\nðŸ“Œ INR monitoring as scheduled."},
      alerts:[["danger","Warfarin requires INR monitoring / ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ† ÙŠØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© INR"],["warn","Check interactions with antibiotics & NSAIDs / Ø§Ù†ØªØ¨Ù‡ Ù„Ù„ØªØ¯Ø§Ø®Ù„Ø§Øª Ù…Ø¹ Ù…Ø¶Ø§Ø¯Ø§Øª Ø­ÙŠÙˆÙŠØ© ÙˆÙ…Ø³ÙƒÙ†Ø§Øª NSAIDs"]],
      hcp:{ar:"Ø«Ø¨Ù‘Øª ÙˆÙ‚Øª Ø§Ù„Ø¬Ø±Ø¹Ø© ÙˆØ±Ø§Ù‚Ø¨ INR Ù…Ø¹ Ø£ÙŠ ØªØºÙŠÙŠØ± ØºØ°Ø§Ø¦ÙŠ/Ø¯ÙˆØ§Ø¦ÙŠ.",en:"Keep dosing time consistent; monitor INR with diet/drug changes."}
    },
    { keys:["omeprazole","pantoprazole","esomeprazole","ppi","Ø£ÙˆÙ…ÙŠØ¨Ø±Ø§Ø²ÙˆÙ„","Ø¨Ø§Ù†ØªÙˆØ¨Ø±Ø§Ø²ÙˆÙ„","Ø¥ÙŠØ²ÙˆÙ…ÙŠØ¨Ø±Ø§Ø²ÙˆÙ„"],
      cat:{ar:"Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ø© (PPI)",en:"Gastric acid suppression (PPI)"},
      patient:{ar:"âœ… Ø§Ù„Ø£ÙØ¶Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ù€ 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø©.\nØ¨Ø¯ÙŠÙ„: Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ± 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø©.\nØ¥Ø°Ø§ Ù…Ø±ØªÙŠÙ†: Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆÙ‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ±.",en:"âœ… Best 30â€“60 min before Iftar.\nAlternative: 30â€“60 min before Suhoor.\nIf BID: before Iftar and before Suhoor."},
      alerts:[["ok","Helpful for reflux / Ù…ÙÙŠØ¯ Ù„Ù„Ø§Ø±ØªØ¬Ø§Ø¹"]],
      hcp:{ar:"Ù‚ÙŠÙ‘Ù… Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø·ÙˆÙŠÙ„Ù‹Ø§ ÙˆØ®Ø·Ø© ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø¥Ù† Ù„Ø²Ù….",en:"Reassess long-term need; step-down plan if appropriate."}
    },
    { keys:["metformin","glucophage","Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ†","Ø¬Ù„ÙˆÙƒÙˆÙØ§Ø¬"],
      cat:{ar:"Ø§Ù„Ø³ÙƒØ± â€“ Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ†",en:"Diabetes â€“ Metformin"},
      patient:{ar:"âœ… Ù…Ø±ØªÙŠÙ†: Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± + Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­ÙˆØ± (Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù…).\nâœ… XR Ù…Ø±Ø©: Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±.",en:"âœ… BID: after Iftar + after Suhoor (with food).\nâœ… XR once: after Iftar."},
      alerts:[["warn","If vomiting/diarrhea or dehydration â†’ ask clinician / Ù…Ø¹ Ø§Ù„Ø¬ÙØ§Ù Ø£Ùˆ Ø¥Ø³Ù‡Ø§Ù„ Ø´Ø¯ÙŠØ¯ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨"]],
      hcp:{ar:"Ø§Ù†ØªØ¨Ù‡ Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒÙ„Ù‰ ÙˆØ®Ø·Ø± Ø§Ù„Ø¬ÙØ§Ù Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØµÙŠØ§Ù….",en:"Monitor renal function; counsel about dehydration risk."}
    },
    { keys:["empagliflozin","dapagliflozin","sglt2","Ø¬Ø§Ø±Ø¯ÙŠÙ†Ø³","Ø¥Ù…Ø¨Ø§ØºÙ„ÙŠÙÙ„ÙˆØ²ÙŠÙ†","Ø¯Ø§Ø¨Ø§ØºÙ„ÙŠÙÙ„ÙˆØ²ÙŠÙ†"],
      cat:{ar:"Ø§Ù„Ø³ÙƒØ± â€“ SGLT2",en:"Diabetes â€“ SGLT2 inhibitor"},
      patient:{ar:"âœ… Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±.\nðŸ’§ Ø§Ø´Ø±Ø¨ Ø³ÙˆØ§Ø¦Ù„ ÙƒØ§ÙÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±.",en:"âœ… Once daily after Iftar.\nðŸ’§ Keep good hydration between Iftar and Suhoor."},
      alerts:[["warn","Dehydration/UTI risk / Ø®Ø·Ø± Ø§Ù„Ø¬ÙØ§Ù ÙˆØ§Ù„ØªÙ‡Ø§Ø¨ Ø¨ÙˆÙ„ÙŠ"]],
      hcp:{ar:"Ù†Ø§Ù‚Ø´ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ø£Ø«Ù†Ø§Ø¡ Ù…Ø±Ø¶ Ø­Ø§Ø¯ ÙˆØ®Ø·Ø± DKA Ù†Ø§Ø¯Ø±.",en:"Sick-day rules; discuss rare euglycemic DKA risk."}
    },
    { keys:["augmentin","amoxicillin","amoxiclav","Ø£ÙˆØ¬Ù…Ù†ØªÙŠÙ†","Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†","Ø£Ù…ÙˆÙƒØ³ÙŠÙƒÙ„Ø§Ù"],
      cat:{ar:"Ù…Ø¶Ø§Ø¯ Ø­ÙŠÙˆÙŠ (BID)",en:"Antibiotic (BID)"},
      patient:{ar:"âœ… Ù…Ø±ØªÙŠÙ†: Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± + Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­ÙˆØ±.\nðŸ“Œ Ø£ÙƒÙ…Ù„ Ø§Ù„ÙƒÙˆØ±Ø³ ÙƒØ§Ù…Ù„.",en:"âœ… BID: after Iftar + after Suhoor.\nðŸ“Œ Finish the full course."},
      alerts:[["warn","Warfarin interaction possible / Ù‚Ø¯ ÙŠØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†"]],
      hcp:{ar:"Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø­Ø³Ø¨ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒÙ„Ù‰ ÙˆØªØ­Ù…Ù„ Ø§Ù„Ù…Ø¹Ø¯Ø©.",en:"Dose per renal function; counsel GI tolerance."}
    },
    { keys:["insulin","Ø§Ù†Ø³ÙˆÙ„ÙŠÙ†","glargine","lantus","aspart","novorapid","humalog","Ù…ÙŠÙƒØ³ØªØ§Ø±Ø¯","mixtard"],
      cat:{ar:"Ø§Ù„Ø³ÙƒØ± â€“ Ø¥Ù†Ø³ÙˆÙ„ÙŠÙ†",en:"Diabetes â€“ Insulin"},
      patient:{ar:"âš  Ø§Ù„Ø¥Ù†Ø³ÙˆÙ„ÙŠÙ† ÙŠØ­ØªØ§Ø¬ Ø®Ø·Ø© ÙØ±Ø¯ÙŠØ©.\nâœ… ØºØ§Ù„Ø¨Ù‹Ø§ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ù…Ø¹ Ø§Ù„Ø¥ÙØ·Ø§Ø±/Ø§Ù„Ø³Ø­ÙˆØ±.\nâ›” Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø¨Ø¯ÙˆÙ† Ø·Ø¨ÙŠØ¨.\nðŸ“Œ Ø£Ø¹Ø±Ø§Ø¶ Ù‡Ø¨ÙˆØ· Ø§Ù„Ø³ÙƒØ± â†’ Ø§ÙØ·Ø± ÙÙˆØ±Ù‹Ø§.",en:"âš  Insulin needs an individualized plan.\nâœ… Mealtime doses with Iftar/Suhoor.\nâ›” Do not change doses without clinician.\nðŸ“Œ Hypoglycemia â†’ break fast immediately."},
      alerts:[["danger","Higher hypoglycemia risk / Ø®Ø·Ø± Ù‡Ø¨ÙˆØ· Ø§Ù„Ø³ÙƒØ± Ø£Ø¹Ù„Ù‰"]],
      hcp:{ar:"Ø·Ø¨Ù‘Ù‚ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø±Ù…Ø¶Ø§Ù† (ØªØ¹Ø¯ÙŠÙ„ basal/bolus ÙˆØªØ¹Ù„ÙŠÙ… SMBG).",en:"Apply Ramadan insulin protocols; SMBG and break-fast rules."}
    },
    { keys:["aspirin","Ø£Ø³Ø¨Ø±ÙŠÙ†","Ø§Ø³Ø¨Ø±ÙŠÙ†","clopidogrel","plavix","Ø¨Ù„Ø§ÙÙŠÙƒØ³","ÙƒÙ„ÙˆØ¨ÙŠØ¯ÙˆÙ‚Ø±ÙŠÙ„"],
      cat:{ar:"Ù…Ø¶Ø§Ø¯ ØµÙØ§Ø¦Ø­",en:"Antiplatelet"},
      patient:{ar:"âœ… ØºØ§Ù„Ø¨Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¥Ø°Ø§ Ø³Ø¨Ø¨ ØªÙ‡ÙŠÙ‘Ø¬ Ù…Ø¹Ø¯Ø©).\nâ›” Ù„Ø§ ØªÙˆÙ‚ÙÙ‡ Ø¨Ø¯ÙˆÙ† Ø·Ø¨ÙŠØ¨.",en:"âœ… Usually after Iftar (with food if GI upset).\nâ›” Do not stop without clinician advice."},
      alerts:[["warn","History of ulcer/GI bleed â†’ consult / ØªØ§Ø±ÙŠØ® Ù‚Ø±Ø­Ø© Ø£Ùˆ Ù†Ø²ÙŠÙ Ù…Ø¹Ø¯Ø© Ø±Ø§Ø¬Ø¹"]],
      hcp:{ar:"Ù‚ÙŠÙ‘Ù… Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ÙˆØ§Ù‚ÙŠ Ù…Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø¹ÙˆØ§Ù…Ù„ Ø®Ø·ÙˆØ±Ø©.",en:"Consider gastroprotection if high risk."}
    }
  ];

  const quick = ["warfarin","omeprazole","metformin","empagliflozin","augmentin","insulin"];

  function t(ar,en){
    const L = ui.lang.value;
    if(L==="ar") return ar;
    if(L==="en") return en;
    return ar + "\n\n" + en;
  }

  function pushMsg(text, who="bot"){
    const row = document.createElement("div");
    row.className = "msg " + (who==="me" ? "me":"bot");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;
    row.appendChild(bubble);
    ui.chat.appendChild(row);
    ui.chat.scrollTop = ui.chat.scrollHeight;
  }

  function normalize(s){
    return (s||"").toLowerCase().trim();
  }

  function findMed(q){
    const qq = normalize(q);
    if(!qq) return null;
    for(const m of meds){
      if(m.keys.some(k => normalize(k)===qq)) return m;
      if(m.keys.some(k => normalize(k).includes(qq) || qq.includes(normalize(k)))) return m;
    }
    return null;
  }

  function renderAnswer(q){
    const med = findMed(q);
    if(!med){
      const msg = t(
        "Ù…Ø§ Ø­ØµÙ„Øª Ø§Ù„Ø¯ÙˆØ§Ø¡. Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ù…Ø«Ø§Ù„: warfarin / ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†).\nØ¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ 3 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø£Ùˆ Ø­Ù‚Ù†/Ø¥Ù†Ø³ÙˆÙ„ÙŠÙ†ØŒ Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø¨Ø£Ù…Ø§Ù†.",
        "I couldnâ€™t find that medication. Try Arabic or English (e.g., warfarin / ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†).\nFor TID regimens or injections/insulin, consult your pharmacist for safe Ramadan adjustments."
      );
      pushMsg(msg,"bot");
      return;
    }

    const mode = ui.mode.value;
    const header = t(
      `ðŸ“Œ Ø§Ù„Ø¯ÙˆØ§Ø¡: ${med.keys[2] || med.keys[0]}\nðŸ§¾ Ø§Ù„ÙØ¦Ø©: ${med.cat.ar}\n`,
      `ðŸ“Œ Medication: ${med.keys[0]}\nðŸ§¾ Category: ${med.cat.en}\n`
    );

    const body = (mode==="hcp")
      ? t("ðŸ§‘â€âš•ï¸ Ù„Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„ØµØ­ÙŠØ©:\n" + (med.hcp?.ar || "â€”"), "ðŸ§‘â€âš•ï¸ For HCP:\n" + (med.hcp?.en || "â€”"))
      : t(med.patient.ar, med.patient.en);

    pushMsg(header + "\n" + body, "bot");

    if(med.alerts?.length){
      for(const [level,text] of med.alerts){
        const prefix = level==="danger" ? "â›” " : level==="warn" ? "âš ï¸ " : "âœ… ";
        pushMsg(prefix + text, "bot");
      }
    }
  }

  function welcome(){
    ui.chat.innerHTML = "";
    const w = t(
      "Ramadan Kareem ðŸŒ™\n\nØ£Ù‡Ù„Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¯ÙˆÙŠØ© Ø±Ù…Ø¶Ø§Ù† â€“ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø·ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ.\nØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙˆØ³Ø£Ø¹Ø·ÙŠÙƒ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£Ù†Ø³Ø¨ Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±.\n\nÙ…Ø«Ø§Ù„: warfarin / omeprazole / metformin / insulin",
      "Ramadan Kareem ðŸŒ™\n\nWelcome to QCH Smart Ramadan Medication Assistant.\nType a medication name and I will suggest timing between Iftar & Suhoor.\n\nExample: warfarin / omeprazole / metformin / insulin"
    );
    pushMsg(w,"bot");
    ui.welcomeBox.textContent = t(
      "Tip: Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠ. Ø§Ø¶ØºØ· Reset Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.",
      "Tip: Type the medication in Arabic or English. Press Reset to start over."
    );
  }

  function buildQuick(){
    ui.quick.innerHTML = "";
    quick.forEach(k=>{
      const b = document.createElement("div");
      b.className = "pill";
      b.textContent = k;
      b.onclick = ()=>{ pushMsg(k,"me"); renderAnswer(k); };
      ui.quick.appendChild(b);
    });
  }

  function send(){
    const q = ui.input.value;
    if(!q.trim()) return;
    pushMsg(q,"me");
    ui.input.value = "";
    renderAnswer(q);
  }

  ui.send.addEventListener("click", send);
  ui.input.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); send(); } });
  ui.reset.addEventListener("click", ()=>{ welcome(); });
  ui.lang.addEventListener("change", ()=>{ welcome(); });
  ui.mode.addEventListener("change", ()=>{ welcome(); });

  // Start
  buildQuick();
  welcome();
})();
</script>
</body>
</html>
  
