<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QCH â€“ Smart Ramadan Medication Assistant (Comprehensive)</title>
  <meta name="description" content="Qatif Central Hospital â€“ Ramadan Medication Assistant (Arabic/English). Evidence-informed general guidance." />
  <style>
    :root{
      --bg:#071a21; --panel:#0c2731; --panel2:#0b222b;
      --text:#eaf6fb; --muted:#b7d2dd;
      --accent:#35d0c7; --accent2:#2aa6ff;
      --danger:#ff4d4f; --warn:#f5a524; --ok:#22c55e;
      --shadow: 0 16px 45px rgba(0,0,0,.35);
      --radius: 18px;
      --card: 1px solid rgba(255,255,255,.10);
      --chip: rgba(53,208,199,.14);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans Arabic", sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(42,166,255,.18), transparent 60%),
                  radial-gradient(900px 600px at 90% 40%, rgba(53,208,199,.16), transparent 55%),
                  linear-gradient(180deg, #06161c, #051217 60%, #040f14);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 14px 28px;}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 14px; border:var(--card); border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position: sticky; top: 10px; backdrop-filter: blur(8px); z-index: 20;
    }
    .brandLeft,.brandRight{display:flex; align-items:center; gap:10px; min-width: 220px;}
    .logo{
      width:56px; height:56px; object-fit:contain;
      border-radius:14px; background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      padding:6px;
    }
    .h1{
      display:flex; flex-direction:column; gap:2px; text-align:center; flex:1;
    }
    .h1 .title{font-size:16px; font-weight:800; letter-spacing:.2px}
    .h1 .sub{font-size:12px; color:var(--muted)}
    .controls{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      transition:.15s transform, .15s background, .15s border;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.22)}
    .btn.primary{background: linear-gradient(135deg, rgba(53,208,199,.30), rgba(42,166,255,.20)); border-color: rgba(53,208,199,.40)}
    .btn.danger{background: rgba(255,77,79,.12); border-color: rgba(255,77,79,.35)}
    .btn.ghost{background: transparent}
    .grid{
      margin-top:14px;
      display:grid; grid-template-columns: 1.15fr .85fr; gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .brandLeft,.brandRight{min-width:auto}
      header{gap:10px; flex-wrap:wrap}
      .h1{order:3; width:100%}
      .controls{justify-content:center; width:100%}
    }
    .panel{
      border:var(--card); border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(12,39,49,.92), rgba(7,26,33,.90));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel .head{
      padding:14px 14px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .panel .head .k{font-weight:900}
    .panel .body{padding:14px}
    .note{
      font-size:12px; color:var(--muted); line-height:1.6;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px; padding:10px 12px;
    }
    .warning{border-color: rgba(245,165,36,.35); background: rgba(245,165,36,.10)}
    .dangerBox{border-color: rgba(255,77,79,.35); background: rgba(255,77,79,.10)}
    .okBox{border-color: rgba(34,197,94,.30); background: rgba(34,197,94,.10)}
    .search{
      display:flex; gap:10px; flex-wrap:wrap;
      margin:10px 0 12px;
    }
    input[type="text"]{
      flex:1;
      min-width: 240px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      color:var(--text);
      outline:none;
    }
    input[type="text"]::placeholder{color: rgba(183,210,221,.75)}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background: var(--chip);
      border:1px solid rgba(53,208,199,.25);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
      transition:.15s transform;
      user-select:none;
      font-size:13px;
    }
    .chip:hover{transform: translateY(-1px)}
    .list{
      display:flex; flex-direction:column; gap:10px;
      max-height: 520px; overflow:auto; padding-right:4px;
    }
    .item{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius:16px;
      padding:12px;
      cursor:pointer;
      transition:.12s transform, .12s background, .12s border;
    }
    .item:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.18)}
    .item .top{display:flex; justify-content:space-between; gap:10px; align-items:flex-start}
    .item .name{font-weight:900}
    .item .meta{color:var(--muted); font-size:12px; margin-top:4px; line-height:1.5}
    .badge{
      font-size:11px; font-weight:900;
      padding:6px 9px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
    }
    .badge.ok{border-color: rgba(34,197,94,.30); background: rgba(34,197,94,.10)}
    .badge.warn{border-color: rgba(245,165,36,.35); background: rgba(245,165,36,.10)}
    .badge.danger{border-color: rgba(255,77,79,.35); background: rgba(255,77,79,.10)}
    .answer{
      display:flex; flex-direction:column; gap:12px;
    }
    .answer .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius:18px;
      padding:12px;
    }
    .answer .card h3{margin:0 0 8px; font-size:14px}
    .answer .card p{margin:0; color:var(--muted); line-height:1.75; font-size:13px}
    .footer{
      margin-top:14px; text-align:center; color: rgba(183,210,221,.85);
      font-size:12px;
    }
    .link{
      color: var(--accent);
      text-decoration:none;
      font-weight:900;
    }
    .hr{height:1px; background: rgba(255,255,255,.10); margin:10px 0}
    .small{font-size:12px; color: var(--muted)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brandLeft" id="brandLeft">
        <img class="logo" src="./qch.png" alt="Qatif Central Hospital Logo"
     onerror="this.src='https://alizakialsada.github.io/qch-ramadan-chatbot
        <div>
          <div style="font-weight:900;font-size:13px" id="qchNameAr">Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø·ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</div>
          <div style="color:var(--muted);font-size:12px" id="qchNameEn">Qatif Central Hospital</div>
        </div>
      </div>

      <div class="h1">
        <div class="title" id="appTitle">Ù…Ø³Ø§Ø¹Ø¯ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ø°ÙƒÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</div>
        <div class="sub" id="appSub">Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ â€¢ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª â€¢ Ø£Ø²Ø±Ø§Ø± ÙÙ‚Ø· â€¢ Ø¹Ø±Ø¨ÙŠ / English</div>
      </div>

      <div class="brandRight" id="brandRight" style="justify-content:flex-end">
        <div style="text-align:end">
          <div style="font-weight:900;font-size:13px" id="hhcNameAr">Ø´Ø±ÙƒØ© Ø§Ù„ØµØ­Ø© Ø§Ù„Ù‚Ø§Ø¨Ø¶Ø©</div>
          <div style="color:var(--muted);font-size:12px" id="hhcNameEn">Health Holding Co</div>
        </div>
<img class="logo" src="./hhc.png" alt="Health Holding Co Logo"
     onerror="this.src='https://alizakialsada.github.io/qch-ramadan-chatbot/hhc.png'">      </div>

      <div class="controls">
        <button class="btn primary" id="btnTop">â­ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§</button>
        <button class="btn" id="btnCats">ğŸ“š Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</button>
        <button class="btn" id="btnSafety">ğŸ›¡ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©</button>
        <button class="btn ghost" id="btnLang">EN</button>
      </div>
    </header>

    <div class="grid">
      <section class="panel">
        <div class="head">
          <div class="k" id="leftTitle">Ø§Ø®ØªØ± Ø¯ÙˆØ§Ø¡ Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</div>
          <div class="small" id="countLbl">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø¨Ø¯ÙˆÙ† ÙƒØ±ÙŠÙ…Ø§Øª)</div>
        </div>
        <div class="body">
          <div class="search">
            <input id="q" type="text" placeholder="Ù…Ø«Ø§Ù„: Metformin / Ø£Ù…Ù„ÙˆØ¯ÙŠØ¨ÙŠÙ† / Warfarin / Insulin glargine" autocomplete="off" />
            <button class="btn primary" id="btnSearch">Ø¨Ø­Ø«</button>
            <button class="btn" id="btnClear">Ù…Ø³Ø­</button>
          </div>

          <div class="note warning" id="hintBox">
            âœ… Ø§Ø®ØªÙØ± Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø£Ùˆ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ.
          </div>

          <div class="chips" id="chips"></div>

          <div class="hr"></div>

          <div class="list" id="list"></div>
        </div>
      </section>

      <aside class="panel">
        <div class="head">
          <div class="k" id="rightTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
          <div class="badge ok" id="statusBadge">Ø¬Ø§Ù‡Ø²</div>
        </div>
        <div class="body">
          <div class="answer" id="answer">
            <div class="card">
              <h3 id="welcomeH">Ø£Ù‡Ù„Ø§Ù‹ ğŸ‘‹</h3>
              <p id="welcomeP">
                Ø§Ø®ØªØ± Ø¯ÙˆØ§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§Ø¶ØºØ· â­ Ù„Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©. Ø³ØªØ¸Ù‡Ø± ØªÙˆØµÙŠØ© Ø¢Ù…Ù†Ø© Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø±Ø¹Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŒ Ù…Ø¹ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.
              </p>
            </div>

            <div class="card dangerBox" id="criticalBox" style="display:none">
              <h3 id="criticalH">ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</h3>
              <p id="criticalP"></p>
            </div>

            <div class="card okBox" id="planBox" style="display:none">
              <h3 id="planH">Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
              <p id="planP"></p>
            </div>

            <div class="card" id="detailsBox" style="display:none">
              <h3 id="detailsH">Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµÙŠØ¯Ù„Ø§Ù†ÙŠØ©</h3>
              <p id="detailsP"></p>
            </div>

            <div class="card" id="whenCallBox" style="display:none">
              <h3 id="whenCallH">Ù…ØªÙ‰ ØªØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨/Ø§Ù„ØµÙŠØ¯Ù„ÙŠØŸ</h3>
              <p id="whenCallP"></p>
            </div>
          </div>

          <div class="footer" id="footerTxt">
            Ø¥Ø¹Ø¯Ø§Ø¯: <b>Ø¹Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¯Ø©</b> â€” Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©ØŒ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø·ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ â€¢
            <span id="disclaimerShort">Ù‡Ø°Ø§ Ù…Ø³Ø§Ø¹Ø¯ ØªÙˆØ¹ÙˆÙŠ ÙˆÙ„ÙŠØ³ ÙˆØµÙØ© Ø¹Ù„Ø§Ø¬ÙŠØ©.</span>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
/* =========================
   Language & UI helpers
========================= */
let lang = "ar"; // "ar" or "en"
const $ = (id)=>document.getElementById(id);

function setDir(){
  document.documentElement.lang = (lang==="ar" ? "ar" : "en");
  document.documentElement.dir  = (lang==="ar" ? "rtl" : "ltr");
  // mirror header sides slightly for LTR
  if(lang==="en"){
    $("brandLeft").style.flexDirection = "row";
    $("brandRight").style.flexDirection = "row";
    $("brandRight").style.textAlign = "start";
  }else{
    $("brandLeft").style.flexDirection = "row";
    $("brandRight").style.flexDirection = "row";
  }
}

const T = {
  ar:{
    appTitle:"Ù…Ø³Ø§Ø¹Ø¯ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ø°ÙƒÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¬Ø±Ø¹Ø§Øª",
    appSub:"Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ â€¢ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª â€¢ Ø£Ø²Ø±Ø§Ø± ÙÙ‚Ø· â€¢ Ø¹Ø±Ø¨ÙŠ / English",
    leftTitle:"Ø§Ø®ØªØ± Ø¯ÙˆØ§Ø¡ Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…",
    rightTitle:"Ø§Ù„Ù†ØªÙŠØ¬Ø©",
    ready:"Ø¬Ø§Ù‡Ø²",
    top:"â­ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§",
    cats:"ğŸ“š Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
    safety:"ğŸ›¡ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©",
    searchPH:"Ù…Ø«Ø§Ù„: Metformin / Ø£Ù…Ù„ÙˆØ¯ÙŠØ¨ÙŠÙ† / Warfarin / Insulin glargine",
    hint:"âœ… Ø§Ø®ØªÙØ± Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø£Ùˆ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ.",
    welcomeH:"Ø£Ù‡Ù„Ø§Ù‹ ğŸ‘‹",
    welcomeP:"Ø§Ø®ØªØ± Ø¯ÙˆØ§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§Ø¶ØºØ· â­ Ù„Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©. Ø³ØªØ¸Ù‡Ø± ØªÙˆØµÙŠØ© Ø¢Ù…Ù†Ø© Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø±Ø¹Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŒ Ù…Ø¹ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.",
    criticalH:"ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…",
    planH:"Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©",
    detailsH:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµÙŠØ¯Ù„Ø§Ù†ÙŠØ©",
    whenCallH:"Ù…ØªÙ‰ ØªØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨/Ø§Ù„ØµÙŠØ¯Ù„ÙŠØŸ",
    footer:"Ø¥Ø¹Ø¯Ø§Ø¯: <b>Ø¹Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¯Ø©</b> â€” Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©ØŒ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø·ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ â€¢ Ù‡Ø°Ø§ Ù…Ø³Ø§Ø¹Ø¯ ØªÙˆØ¹ÙˆÙŠ ÙˆÙ„ÙŠØ³ ÙˆØµÙØ© Ø¹Ù„Ø§Ø¬ÙŠØ©.",
    count:"Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø§Ù…Ù„Ø© (Ø¨Ø¯ÙˆÙ† ÙƒØ±ÙŠÙ…Ø§Øª)",
    noResults:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬. Ø¬Ø±Ù‘Ø¨ Ø§Ø³Ù…Ù‹Ø§ Ø¹Ù„Ù…ÙŠÙ‹Ø§/ØªØ¬Ø§Ø±ÙŠÙ‹Ø§ Ø¢Ø®Ø±.",
    btnSearch:"Ø¨Ø­Ø«",
    btnClear:"Ù…Ø³Ø­"
  },
  en:{
    appTitle:"Smart Ramadan Medication Timing Assistant",
    appSub:"Fast search â€¢ Suggestions â€¢ Buttons only â€¢ Arabic / English",
    leftTitle:"Pick a medication or search by name",
    rightTitle:"Result",
    ready:"Ready",
    top:"â­ Top common meds",
    cats:"ğŸ“š Categories",
    safety:"ğŸ›¡ï¸ Safety notes",
    searchPH:"e.g., Metformin / Amlodipine / Warfarin / Insulin glargine",
    hint:"âœ… Prefer the buttons. If your medicine is not listed, search using generic or brand name.",
    welcomeH:"Welcome ğŸ‘‹",
    welcomeP:"Pick a medication or tap â­ for common meds. You will get a fasting-friendly timing plan with key warnings.",
    criticalH:"Important warning",
    planH:"Suggested plan",
    detailsH:"Pharmacy notes",
    whenCallH:"When to contact your clinician",
    footer:"Prepared by <b>Ali Alsada</b> â€” Pharmacy Dept., Qatif Central Hospital â€¢ Educational tool, not a prescription.",
    count:"Comprehensive database (no creams)",
    noResults:"No results. Try another generic/brand name.",
    btnSearch:"Search",
    btnClear:"Clear"
  }
};

function applyLang(){
  $("appTitle").textContent = T[lang].appTitle;
  $("appSub").textContent   = T[lang].appSub;
  $("leftTitle").textContent= T[lang].leftTitle;
  $("rightTitle").textContent= T[lang].rightTitle;
  $("statusBadge").textContent= T[lang].ready;
  $("btnTop").textContent   = T[lang].top;
  $("btnCats").textContent  = T[lang].cats;
  $("btnSafety").textContent= T[lang].safety;
  $("q").placeholder        = T[lang].searchPH;
  $("hintBox").textContent  = T[lang].hint;
  $("welcomeH").textContent = T[lang].welcomeH;
  $("welcomeP").textContent = T[lang].welcomeP;
  $("criticalH").textContent= T[lang].criticalH;
  $("planH").textContent    = T[lang].planH;
  $("detailsH").textContent = T[lang].detailsH;
  $("whenCallH").textContent= T[lang].whenCallH;
  $("footerTxt").innerHTML  = (lang==="ar" ? 'Ø¥Ø¹Ø¯Ø§Ø¯: <b>Ø¹Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¯Ø©</b> â€” Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©ØŒ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚Ø·ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ â€¢ <span id="disclaimerShort">Ù‡Ø°Ø§ Ù…Ø³Ø§Ø¹Ø¯ ØªÙˆØ¹ÙˆÙŠ ÙˆÙ„ÙŠØ³ ÙˆØµÙØ© Ø¹Ù„Ø§Ø¬ÙŠØ©.</span>' :
                                          'Prepared by <b>Ali Alsada</b> â€” Pharmacy Dept., Qatif Central Hospital â€¢ <span id="disclaimerShort">Educational tool, not a prescription.</span>');
  $("countLbl").textContent = T[lang].count;
  $("btnSearch").textContent= T[lang].btnSearch;
  $("btnClear").textContent = T[lang].btnClear;
  $("btnLang").textContent  = (lang==="ar" ? "EN" : "AR");
  setDir();
  renderChips(currentMode);
  renderList(currentList);
}

/* =========================
   Core knowledge model
   - no creams/topicals (excluded)
   - includes oral + injections + inhalers + eye/ear drops guidance
========================= */

const CATS = [
  {id:"top", ar:"â­ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©", en:"â­ Common"},
  {id:"dm", ar:"Ø§Ù„Ø³ÙƒØ±ÙŠ", en:"Diabetes"},
  {id:"htn", ar:"Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ù‚Ù„Ø¨", en:"BP & Heart"},
  {id:"lipid", ar:"Ø§Ù„Ø¯Ù‡ÙˆÙ†", en:"Lipids"},
  {id:"anticoag", ar:"Ù…Ø¶Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®Ø«Ø±/Ø§Ù„ØªØ¬Ù„Ø·", en:"Anticoag/Antiplatelet"},
  {id:"abx", ar:"Ù…Ø¶Ø§Ø¯Ø§Øª Ø­ÙŠÙˆÙŠØ©", en:"Antibiotics"},
  {id:"gi", ar:"Ø§Ù„Ù…Ø¹Ø¯Ø©/Ø§Ù„Ø§Ø±ØªØ¬Ø§Ø¹/Ø§Ù„Ù‚ÙˆÙ„ÙˆÙ†", en:"GI"},
  {id:"asthma", ar:"Ø§Ù„Ø±Ø¨Ùˆ ÙˆØ§Ù„ØªÙ†ÙØ³", en:"Respiratory"},
  {id:"neuro", ar:"Ø§Ù„ØµØ±Ø¹/Ø§Ù„Ø£Ø¹ØµØ§Ø¨", en:"Neuro (Seizure etc.)"},
  {id:"psych", ar:"Ø§Ù„Ù†ÙØ³ÙŠØ©", en:"Psych"},
  {id:"thyroid", ar:"Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©", en:"Thyroid"},
  {id:"pain", ar:"Ø§Ù„Ø£Ù„Ù… ÙˆØ§Ù„Ø§Ù„ØªÙ‡Ø§Ø¨", en:"Pain/Inflammation"},
  {id:"steroid", ar:"Ø§Ù„ÙƒÙˆØ±ØªÙŠØ²ÙˆÙ† ÙˆØ§Ù„Ù…Ø«Ø¨Ø·Ø§Øª", en:"Steroids/Immuno"},
  {id:"renal", ar:"Ø§Ù„ÙƒÙ„Ù‰/Ø§Ù„Ø³ÙˆØ§Ø¦Ù„", en:"Renal/Fluids"},
  {id:"other", ar:"Ø£Ø¯ÙˆÙŠØ© Ø£Ø®Ø±Ù‰", en:"Other"}
];

/*
Rule types:
- OD: once daily
- BID: twice daily
- TID: three times
- QID: four times
- WEEKLY: weekly
- PRN: as needed
- SPECIAL: uses custom logic function
*/
const MEDS = [
  /* ========= TOP COMMON (Top 20) ========= */
  {k:"metformin", names:["Metformin","Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ†","Ø¬Ù„ÙˆÙƒÙˆÙØ§Ø¬","Glucophage"], cat:"dm", freq:"BID", form:"IR", badge:"warn",
    ar:{short:"Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ† (IR)", hint:"Ø¥Ø°Ø§ Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠÙ‹Ø§: Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø¥Ø°Ø§ 3 Ù…Ø±Ø§Øª: ÙŠØ­ØªØ§Ø¬ ØªÙ‚ÙŠÙŠÙ… Ù„ØªØ­ÙˆÙŠÙ„/ØªØ¹Ø¯ÙŠÙ„."},
    en:{short:"Metformin (IR)", hint:"If BID: Iftar + Suhoor. If TID: consider clinician review to simplify."}
  },
  {k:"metformin_xr", names:["Metformin XR","Glucophage XR","Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ† Ù…Ù…ØªØ¯","Ø¬Ù„ÙˆÙƒÙˆÙØ§Ø¬ Ø§ÙƒØ³ Ø¢Ø±"], cat:"dm", freq:"OD", form:"XR", badge:"ok",
    ar:{short:"Ù…ÙŠØªÙÙˆØ±Ù…ÙŠÙ† XR", hint:"Ø¹Ø§Ø¯Ø©Ù‹ Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù…Ø¹ Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø£Ùˆ Ø£ÙƒØ¨Ø± ÙˆØ¬Ø¨Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±)."},
    en:{short:"Metformin XR", hint:"Usually once daily with Iftar (largest evening meal)."}
  },
  {k:"amlodipine", names:["Amlodipine","Ø£Ù…Ù„ÙˆØ¯ÙŠØ¨ÙŠÙ†","Norvasc","Ù†ÙˆØ±ÙØ§Ø³Ùƒ"], cat:"htn", freq:"OD", form:"", badge:"ok",
    ar:{short:"Ø£Ù…Ù„ÙˆØ¯ÙŠØ¨ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±ØŒ Ø«Ø¨Ù‘Øª Ø§Ù„ÙˆÙ‚Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§."},
    en:{short:"Amlodipine", hint:"Once daily after Iftar; keep timing consistent."}
  },
  {k:"losartan", names:["Losartan","Ù„ÙˆØ³Ø§Ø±ØªØ§Ù†","Cozaar","ÙƒÙˆØ²Ø§Ø±"], cat:"htn", freq:"OD", form:"", badge:"ok",
    ar:{short:"Ù„ÙˆØ³Ø§Ø±ØªØ§Ù†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¯ÙˆØ®Ø©/Ø§Ù„Ø¶ØºØ·."},
    en:{short:"Losartan", hint:"Once daily after Iftar. Monitor dizziness/BP."}
  },
  {k:"valsartan", names:["Valsartan","ÙØ§Ù„Ø³Ø§Ø±ØªØ§Ù†","Diovan","Ø¯ÙŠÙˆÙØ§Ù†"], cat:"htn", freq:"OD", form:"", badge:"ok",
    ar:{short:"ÙØ§Ù„Ø³Ø§Ø±ØªØ§Ù†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±."},
    en:{short:"Valsartan", hint:"Once daily after Iftar."}
  },
  {k:"lisinopril", names:["Lisinopril","Ù„ÙŠØ²ÙŠÙ†ÙˆØ¨Ø±ÙŠÙ„"], cat:"htn", freq:"OD", badge:"ok",
    ar:{short:"Ù„ÙŠØ²ÙŠÙ†ÙˆØ¨Ø±ÙŠÙ„", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ø¥Ø°Ø§ Ù…ÙØ¯Ø±Ù‘ Ø¨ÙˆÙ„ Ù…Ø¹Ù‡: Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ø¬ÙØ§Ù."},
    en:{short:"Lisinopril", hint:"Once daily after Iftar. If combined with diuretics: watch dehydration."}
  },
  {k:"atorvastatin", names:["Atorvastatin","Ø£ØªÙˆØ±ÙØ§Ø³ØªØ§ØªÙŠÙ†","Lipitor","Ù„ÙŠØ¨ÙŠØªÙˆØ±"], cat:"lipid", freq:"OD", badge:"ok",
    ar:{short:"Ø£ØªÙˆØ±ÙØ§Ø³ØªØ§ØªÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­)."},
    en:{short:"Atorvastatin", hint:"Once daily after Iftar or at bedtime."}
  },
  {k:"rosuvastatin", names:["Rosuvastatin","Ø±ÙˆØ²ÙˆÙØ§Ø³ØªØ§ØªÙŠÙ†","Crestor","ÙƒØ±ÙŠØ³ØªÙˆØ±"], cat:"lipid", freq:"OD", badge:"ok",
    ar:{short:"Ø±ÙˆØ²ÙˆÙØ§Ø³ØªØ§ØªÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…."},
    en:{short:"Rosuvastatin", hint:"Once daily after Iftar or at bedtime."}
  },
  {k:"aspirin", names:["Aspirin","Ø£Ø³Ø¨Ø±ÙŠÙ†","ASA","ÙƒØ§Ø±Ø¯ÙŠÙˆ Ø£Ø³Ø¨Ø±ÙŠÙ†"], cat:"anticoag", freq:"OD", badge:"ok",
    ar:{short:"Ø£Ø³Ø¨Ø±ÙŠÙ† Ø¬Ø±Ø¹Ø© ÙˆÙ‚Ø§Ø¦ÙŠØ©", hint:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù„ØªÙ‚Ù„ÙŠÙ„ ØªÙ‡ÙŠÙ‘Ø¬ Ø§Ù„Ù…Ø¹Ø¯Ø© (Ø¥Ù† Ø£Ù…ÙƒÙ†)."},
    en:{short:"Low-dose aspirin", hint:"After Iftar to reduce stomach upset (if possible)."}
  },
  {k:"clopidogrel", names:["Clopidogrel","ÙƒÙ„ÙˆØ¨ÙŠØ¯ÙˆÙ‚Ø±Ù„","Plavix","Ø¨Ù„Ø§ÙÙŠÙƒØ³"], cat:"anticoag", freq:"OD", badge:"ok",
    ar:{short:"ÙƒÙ„ÙˆØ¨ÙŠØ¯ÙˆÙ‚Ø±Ù„", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ù„Ø§ ØªÙˆÙ‚ÙÙ‡ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¨."},
    en:{short:"Clopidogrel", hint:"Once daily after Iftar. Do not stop without clinician advice."}
  },
  {k:"warfarin", names:["Warfarin","ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†"], cat:"anticoag", freq:"OD", badge:"warn",
    ar:{short:"ÙˆØ§Ø±ÙØ§Ø±ÙŠÙ†", hint:"ÙŠÙØ¶Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙÙŠ ÙˆÙ‚Øª Ø«Ø§Ø¨Øª. Ø§Ù„ØªØ²Ù… Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ INR."},
    en:{short:"Warfarin", hint:"Prefer after Iftar at a fixed time. Keep INR monitoring as scheduled."}
  },
  {k:"rivaroxaban", names:["Rivaroxaban","Ø±ÙŠÙØ§Ø±ÙˆÙƒØ³Ø§Ø¨Ø§Ù†","Xarelto","Ø²Ø§Ø±ÙŠÙ„ØªÙˆ"], cat:"anticoag", freq:"OD", badge:"warn",
    ar:{short:"Ø±ÙŠÙØ§Ø±ÙˆÙƒØ³Ø§Ø¨Ø§Ù†", hint:"Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©: Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª ÙŠÙ„Ø²Ù… ØªÙ†Ø§ÙˆÙ„Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù…. ØºØ§Ù„Ø¨Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±."},
    en:{short:"Rivaroxaban", hint:"Some doses must be taken with food. Often best after Iftar."}
  },
  {k:"apixaban", names:["Apixaban","Ø£Ø¨ÙŠÙƒØ³Ø§Ø¨Ø§Ù†","Eliquis","Ø¥Ù„ÙŠÙƒÙˆÙŠØ³"], cat:"anticoag", freq:"BID", badge:"warn",
    ar:{short:"Ø£Ø¨ÙŠÙƒØ³Ø§Ø¨Ø§Ù†", hint:"Ø¬Ø±Ø¹ØªØ§Ù†: Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ù„Ø§ ØªÙÙˆÙ‘Øª Ø¬Ø±Ø¹Ø©."},
    en:{short:"Apixaban", hint:"BID: Iftar + Suhoor. Avoid missed doses."}
  },
  {k:"omeprazole", names:["Omeprazole","Ø£ÙˆÙ…ÙŠØ¨Ø±Ø§Ø²ÙˆÙ„","Losec","Ù„ÙˆØ³ÙŠÙƒ"], cat:"gi", freq:"OD", badge:"ok",
    ar:{short:"Ø£ÙˆÙ…ÙŠØ¨Ø±Ø§Ø²ÙˆÙ„", hint:"Ø§Ù„Ø£ÙØ¶Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ù€ 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø© (Ø¥Ø°Ø§ ÙŠØ³Ø¨Ø¨ Ø­Ø±Ù‚Ø©). Ø¨Ø¯ÙŠÙ„: Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ±."},
    en:{short:"Omeprazole", hint:"Best 30â€“60 min before Iftar if reflux symptoms. Alternative: before Suhoor."}
  },
  {k:"pantoprazole", names:["Pantoprazole","Ø¨Ø§Ù†ØªÙˆØ¨Ø±Ø§Ø²ÙˆÙ„","Controloc","ÙƒÙˆÙ†ØªØ±ÙˆÙ„ÙˆÙƒ"], cat:"gi", freq:"OD", badge:"ok",
    ar:{short:"Ø¨Ø§Ù†ØªÙˆØ¨Ø±Ø§Ø²ÙˆÙ„", hint:"Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ù€ 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ±."},
    en:{short:"Pantoprazole", hint:"30â€“60 min before Iftar, or before Suhoor."}
  },
  {k:"levothyroxine", names:["Levothyroxine","Ù„ÙŠÙÙˆØ«ÙŠØ±ÙˆÙƒØ³ÙŠÙ†","Euthyrox","ÙŠÙˆØ«ÙŠØ±ÙˆÙƒØ³"], cat:"thyroid", freq:"OD", badge:"warn",
    ar:{short:"Ù„ÙŠÙÙˆØ«ÙŠØ±ÙˆÙƒØ³ÙŠÙ†", hint:"Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ø© ÙØ§Ø±ØºØ©: Ø¥Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ± Ø¨Ù€ 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ù€ 3â€“4 Ø³Ø§Ø¹Ø§Øª."},
    en:{short:"Levothyroxine", hint:"Empty stomach: 30â€“60 min before Suhoor OR bedtime 3â€“4h after last meal."}
  },
  {k:"sertraline", names:["Sertraline","Ø³ÙŠØ±ØªØ±Ø§Ù„ÙŠÙ†","Zoloft","Ø²ÙˆÙ„ÙˆÙØª"], cat:"psych", freq:"OD", badge:"ok",
    ar:{short:"Ø³ÙŠØ±ØªØ±Ø§Ù„ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø­Ø³Ø¨ Ø§Ù„ØªØ­Ù…Ù„."},
    en:{short:"Sertraline", hint:"Once daily after Iftar or at bedtime depending on tolerability."}
  },
  {k:"paracetamol", names:["Paracetamol","Acetaminophen","Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„","Ø¨Ù†Ø§Ø¯ÙˆÙ„","Panadol"], cat:"pain", freq:"PRN", badge:"ok",
    ar:{short:"Ø¨Ø§Ø±Ø§Ø³ÙŠØªØ§Ù…ÙˆÙ„", hint:"Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ø§Ù„Ø³Ø­ÙˆØ±. Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙˆØµÙˆÙØ©."},
    en:{short:"Paracetamol", hint:"PRN after Iftar or Suhoor. Do not exceed prescribed daily max."}
  },
  {k:"ibuprofen", names:["Ibuprofen","Ø§ÙŠØ¨ÙˆØ¨Ø±ÙˆÙÙŠÙ†","Brufen","Ø¨Ø±ÙˆÙÙŠÙ†"], cat:"pain", freq:"PRN", badge:"warn",
    ar:{short:"Ø¥ÙŠØ¨ÙˆØ¨Ø±ÙˆÙÙŠÙ†", hint:"Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„ (Ø¥ÙØ·Ø§Ø±/Ø³Ø­ÙˆØ±). ØªØ¬Ù†Ø¨Ù‡ Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù‚Ø±Ø­Ø©/Ø§Ù„ÙƒÙ„Ù‰ Ø¥Ù„Ø§ Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø·Ø¨ÙŠ."},
    en:{short:"Ibuprofen", hint:"Take with food. Avoid if ulcers/kidney disease unless clinician advised."}
  },
  {k:"salbutamol", names:["Salbutamol inhaler","Ventolin","Ø³Ø§Ù„Ø¨ÙˆØªØ§Ù…ÙˆÙ„","ÙÙ†ØªÙˆÙ„ÙŠÙ†"], cat:"asthma", freq:"PRN", route:"inhaled", badge:"ok",
    ar:{short:"ÙÙ†ØªÙˆÙ„ÙŠÙ† Ø¨Ø®Ø§Ø®", hint:"Ù„Ø§ ÙŠÙØ·Ø± Ø¹Ø§Ø¯Ø©Ù‹ (Ø§Ø³ØªÙ†Ø´Ø§Ù‚). Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©."},
    en:{short:"Salbutamol inhaler", hint:"Generally does not break the fast (inhaled). Use as needed."}
  },

  /* ========= DIABETES ========= */
  {k:"glargine", names:["Insulin glargine","Glargine","Lantus","Toujeo","Basaglar","Ø¬Ù„Ø§Ø±Ø¬ÙŠÙ†","Ù„Ø§Ù†ØªÙˆØ³","ØªÙˆØ¬ÙŠÙˆ"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¬Ù„Ø§Ø±Ø¬ÙŠÙ† (Basal)", hint:"ÙŠÙØ¹Ø¯Ù‘Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¨. ØºØ§Ù„Ø¨Ù‹Ø§ ÙŠÙÙ†Ù‚Ù„ ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø®ÙØ¶ Ø¬Ø±Ø¹Ø© Ù„ØªØ¬Ù†Ø¨ Ù‡Ø¨ÙˆØ· Ø§Ù„Ø³ÙƒØ±."},
    en:{short:"Insulin glargine (Basal)", hint:"Clinician-guided. Often moved to Iftar/bedtime. Dose reduction may be needed to prevent hypoglycemia."}
  },
  {k:"detemir", names:["Insulin detemir","Detemir","Levemir","Ø¯ÛŒØªÙŠÙ…ÙŠØ±","Ù„ÙŠÙÙŠÙ…ÙŠØ±"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¯ÙŠØªÙŠÙ…ÙŠØ±", hint:"Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø±Ø© Ø£Ùˆ Ù…Ø±ØªÙŠÙ†. ÙŠØ­ØªØ§Ø¬ Ø®Ø·Ø© ÙØ±Ø¯ÙŠØ© (Ø¥ÙØ·Ø§Ø±/Ø³Ø­ÙˆØ±) Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø©."},
    en:{short:"Insulin detemir", hint:"May be once or twice daily; individualized plan with dose adjustment."}
  },
  {k:"degludec", names:["Insulin degludec","Tresiba","Ø¯ÙŠØ¬Ù„ÙˆØ¯ÙŠÙƒ","ØªØ±ÙŠØ³ÙŠØ¨Ø§"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¯ÙŠØ¬Ù„ÙˆØ¯ÙŠÙƒ", hint:"Ù…Ø±Ù† ÙÙŠ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù„ÙƒÙ† ÙŠØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙƒØ± ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¬Ø±Ø¹Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù‡Ø¨ÙˆØ·."},
    en:{short:"Insulin degludec", hint:"Flexible timing but needs SMBG and dose adjustment to avoid lows."}
  },
  {k:"aspart", names:["Insulin aspart","Novorapid","Ø£Ø³Ø¨Ø§Ø±Øª","Ù†ÙˆÙÙˆØ±Ø§Ø¨ÙŠØ¯"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø³Ø±ÙŠØ¹ (Ø£Ø³Ø¨Ø§Ø±Øª)", hint:"ÙŠÙØ¤Ø®Ø° Ù…Ø¹ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª: Ø§Ù„Ø¥ÙØ·Ø§Ø±/Ø§Ù„Ø³Ø­ÙˆØ± Ø­Ø³Ø¨ ÙƒÙ…ÙŠØ© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª + Ù‚ÙŠØ§Ø³ Ø§Ù„Ø³ÙƒØ±."},
    en:{short:"Rapid insulin (Aspart)", hint:"With meals: Iftar/Suhoor based on carbs + glucose checks."}
  },
  {k:"lispro", names:["Insulin lispro","Humalog","Ù„ÙŠØ²Ø¨Ø±Ùˆ","Ù‡ÙŠÙˆÙ…Ø§Ù„ÙˆØ¬"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø³Ø±ÙŠØ¹ (Ù„ÙŠØ²Ø¨Ø±Ùˆ)", hint:"Ù…Ø¹ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª (Ø¥ÙØ·Ø§Ø±/Ø³Ø­ÙˆØ±). ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙˆØ§Ù„Ù‚ÙŠØ§Ø³Ø§Øª."},
    en:{short:"Rapid insulin (Lispro)", hint:"With Iftar/Suhoor meals. Dose guided by clinician and SMBG."}
  },
  {k:"regular", names:["Regular insulin","Actrapid","Ø§Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¹Ø§Ø¯ÙŠ","Ø£ÙƒØªØ±Ø¨ÙŠØ¯"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ø¹Ø§Ø¯ÙŠ", hint:"Ù‚Ø¨Ù„ Ø§Ù„ÙˆØ¬Ø¨Ø© Ø¨Ù€ 30 Ø¯Ù‚ÙŠÙ‚Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§. Ø®Ø·Ø± Ù‡Ø¨ÙˆØ· Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ø§Ù„ÙˆØ¬Ø¨Ø©."},
    en:{short:"Regular insulin", hint:"~30 min before meal. Hypoglycemia risk if meal timing changes."}
  },
  {k:"premix", names:["Premixed insulin","Mixtard","Humulin 70/30","Ø§Ù†Ø³ÙˆÙ„ÙŠÙ† Ù…Ø®Ù„ÙˆØ·","Ù…ÙŠÙƒØ³ØªØ§Ø±Ø¯"], cat:"dm", freq:"SPECIAL", badge:"danger",
    ar:{short:"Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† Ù…Ø®Ù„ÙˆØ·", hint:"ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ø¶Ø­: ØºØ§Ù„Ø¨Ù‹Ø§ Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø¨Ø¯Ù„ Ø§Ù„ØµØ¨Ø§Ø­) ÙˆØ¬Ø±Ø¹Ø© Ø§Ù„Ø³Ø­ÙˆØ± Ø£Ù‚Ù„. Ù„Ø§Ø²Ù… Ø·Ø¨ÙŠØ¨."},
    en:{short:"Premixed insulin", hint:"Requires careful Ramadan plan: Iftar dose often replaces morning; Suhoor dose reduced. Clinician required."}
  },
  {k:"gliclazide", names:["Gliclazide","Diamicron","Ø¬Ù„ÙŠÙƒÙ„Ø§Ø²Ø§ÙŠØ¯","Ø¯ÙŠØ§Ù…ÙƒØ±ÙˆÙ†"], cat:"dm", freq:"OD", badge:"danger",
    ar:{short:"Ø¬Ù„ÙŠÙƒÙ„Ø§Ø²Ø§ÙŠØ¯", hint:"Ø®Ø·Ø± Ù‡Ø¨ÙˆØ· Ø³ÙƒØ±. ØºØ§Ù„Ø¨Ù‹Ø§ ÙŠØ¤Ø®Ø° Ù…Ø¹ Ø§Ù„Ø¥ÙØ·Ø§Ø± (ÙˆÙ‚Ø¯ ØªÙØ®ÙØ¶ Ø§Ù„Ø¬Ø±Ø¹Ø©). Ù„Ø§Ø²Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø³ÙƒØ±."},
    en:{short:"Gliclazide", hint:"Hypoglycemia risk. Often with Iftar (dose may need reduction). Monitor glucose."}
  },
  {k:"glimepiride", names:["Glimepiride","Amaryl","Ø¬Ù„ÙŠÙ…Ø¨ÙŠØ±ÙŠØ¯","Ø£Ù…Ø§Ø±ÙŠÙ„"], cat:"dm", freq:"OD", badge:"danger",
    ar:{short:"Ø¬Ù„ÙŠÙ…Ø¨ÙŠØ±ÙŠØ¯", hint:"Ø®Ø·Ø± Ù‡Ø¨ÙˆØ·. ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø¹ Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ¨Ø¬Ø±Ø¹Ø© Ø£Ù‚Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¨."},
    en:{short:"Glimepiride", hint:"Hypoglycemia risk. Often with Iftar; dose may need reduction."}
  },
  {k:"sitagliptin", names:["Sitagliptin","Januvia","Ø³ÙŠØªØ§Ø¬Ù„ÙŠØ¨ØªÙŠÙ†","Ø¬Ø§Ù†ÙˆÙÙŠØ§"], cat:"dm", freq:"OD", badge:"ok",
    ar:{short:"Ø³ÙŠØªØ§Ø¬Ù„ÙŠØ¨ØªÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ø§Ù„Ø³Ø­ÙˆØ± (Ø«Ø¨Ù‘Øª Ø§Ù„ÙˆÙ‚Øª)."},
    en:{short:"Sitagliptin", hint:"Once daily after Iftar or Suhoor; keep consistent."}
  },
  {k:"linagliptin", names:["Linagliptin","Trajenta","Ù„ÙŠÙ†Ø§Ø¬Ù„ÙŠØ¨ØªÙŠÙ†","ØªØ±Ø§Ø¬Ù†ØªØ§"], cat:"dm", freq:"OD", badge:"ok",
    ar:{short:"Ù„ÙŠÙ†Ø§Ø¬Ù„ÙŠØ¨ØªÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ø§Ù„Ø³Ø­ÙˆØ±."},
    en:{short:"Linagliptin", hint:"Once daily after Iftar or Suhoor."}
  },
  {k:"empagliflozin", names:["Empagliflozin","Jardiance","Ø¥Ù…Ø¨Ø§Ø¬Ù„ÙŠÙÙ„ÙˆØ²ÙŠÙ†","Ø¬Ø§Ø±Ø¯ÙŠÙ†Ø³"], cat:"dm", freq:"OD", badge:"warn",
    ar:{short:"SGLT2 (Ø¥Ù…Ø¨Ø§Ø¬Ù„ÙŠÙÙ„ÙˆØ²ÙŠÙ†)", hint:"Ù‚Ø¯ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø¬ÙØ§Ù/Ø§Ù„ØªØ¨ÙˆÙ„. ÙŠÙÙØ¶Ù‘Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù…Ø¹ Ø³ÙˆØ§Ø¦Ù„ ÙƒØ§ÙÙŠØ©. ØªÙˆÙ‚Ù ÙˆØ±Ø§Ø¬Ø¹ Ø¥Ø°Ø§ Ø¯ÙˆØ®Ø©/Ø¬ÙØ§Ù/Ø§Ù„ØªÙ‡Ø§Ø¨."},
    en:{short:"SGLT2 (Empagliflozin)", hint:"Dehydration risk. Prefer after Iftar with adequate fluids. Seek care if dizziness/dehydration/infection."}
  },
  {k:"dapagliflozin", names:["Dapagliflozin","Forxiga","Ø¯Ø§Ø¨Ø§Ø¬Ù„ÙŠÙÙ„ÙˆØ²ÙŠÙ†","ÙÙˆØ±Ø³ÙŠØ¬Ø§"], cat:"dm", freq:"OD", badge:"warn",
    ar:{short:"SGLT2 (Ø¯Ø§Ø¨Ø§Ø¬Ù„ÙŠÙÙ„ÙˆØ²ÙŠÙ†)", hint:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù…Ø¹ Ø³ÙˆØ§Ø¦Ù„ ÙƒØ§ÙÙŠØ©. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¬ÙØ§Ù/Ø§Ù„ØªÙ‡Ø§Ø¨Ø§Øª Ø¨ÙˆÙ„ÙŠØ©."},
    en:{short:"SGLT2 (Dapagliflozin)", hint:"After Iftar with adequate fluids. Watch dehydration/UTIs."}
  },
  {k:"semaglutide", names:["Semaglutide","Ozempic","Wegovy","Ø³ÙŠÙ…Ø§Ø¬Ù„ÙˆØªØ§ÙŠØ¯","Ø£ÙˆØ²Ù…Ø¨ÙŠÙƒ"], cat:"dm", freq:"WEEKLY", badge:"warn",
    ar:{short:"Ø³ÙŠÙ…Ø§Ø¬Ù„ÙˆØªØ§ÙŠØ¯ Ø£Ø³Ø¨ÙˆØ¹ÙŠ", hint:"Ù„Ø§ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„ØµÙŠØ§Ù… ØºØ§Ù„Ø¨Ù‹Ø§. Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§ Ø«Ø§Ø¨ØªÙ‹Ø§. Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ ØºØ«ÙŠØ§Ù†/Ù‚Ù„Ø© Ø´Ù‡ÙŠØ©."},
    en:{short:"Semaglutide weekly", hint:"Usually unaffected by fasting. Keep same weekday. Nausea/appetite loss possible."}
  },
  {k:"liraglutide", names:["Liraglutide","Victoza","Ù„ÙŠØ±Ø§Ø¬Ù„ÙˆØªØ§ÙŠØ¯","ÙÙŠÙƒØªÙˆØ²Ø§"], cat:"dm", freq:"OD", badge:"warn",
    ar:{short:"Ù„ÙŠØ±Ø§Ø¬Ù„ÙˆØªØ§ÙŠØ¯", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§Ø› Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…. Ø±Ø§Ù‚Ø¨ Ø§Ù„ØºØ«ÙŠØ§Ù†."},
    en:{short:"Liraglutide", hint:"Once daily after Iftar or bedtime. Monitor nausea."}
  },

  /* ========= BP & HEART ========= */
  {k:"bisoprolol", names:["Bisoprolol","Ø¨ÙŠØ³ÙˆØ¨Ø±ÙˆÙ„ÙˆÙ„","Concor","ÙƒÙˆÙ†ÙƒÙˆØ±"], cat:"htn", freq:"OD", badge:"ok",
    ar:{short:"Ø¨ÙŠØ³ÙˆØ¨Ø±ÙˆÙ„ÙˆÙ„", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù†Ø¨Ø¶ ÙˆØ§Ù„Ø¯ÙˆØ®Ø©."},
    en:{short:"Bisoprolol", hint:"Once daily after Iftar. Monitor pulse and dizziness."}
  },
  {k:"metoprolol", names:["Metoprolol","Ù…ÙŠØªÙˆØ¨Ø±ÙˆÙ„ÙˆÙ„"], cat:"htn", freq:"BID", badge:"warn",
    ar:{short:"Ù…ÙŠØªÙˆØ¨Ø±ÙˆÙ„ÙˆÙ„", hint:"Ø¥Ø°Ø§ Ù…Ø±ØªÙŠÙ†: Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø¥Ù† ÙƒØ§Ù† Ù…Ù…ØªØ¯ (ER) Ù‚Ø¯ ÙŠØµØ¨Ø­ Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¨."},
    en:{short:"Metoprolol", hint:"If BID: Iftar + Suhoor. ER forms may be once daily per clinician."}
  },
  {k:"carvedilol", names:["Carvedilol","ÙƒØ§Ø±ÙÙŠØ¯ÙŠÙ„ÙˆÙ„"], cat:"htn", freq:"BID", badge:"warn",
    ar:{short:"ÙƒØ§Ø±ÙÙŠØ¯ÙŠÙ„ÙˆÙ„", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ± Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù… (Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ®Ø©)."},
    en:{short:"Carvedilol", hint:"Iftar + Suhoor with food to reduce dizziness."}
  },
  {k:"furosemide", names:["Furosemide","Lasix","ÙÙˆØ±ÙˆØ³ÙŠÙ…ÙŠØ¯","Ù„Ø§Ø²ÙƒØ³"], cat:"renal", freq:"OD", badge:"warn",
    ar:{short:"ÙÙˆØ±ÙˆØ³ÙŠÙ…ÙŠØ¯ (Ù…Ø¯Ø±)", hint:"ÙŠÙØ¶Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù…Ø¨ÙƒØ±Ù‹Ø§ Ù„ØªØ¬Ù†Ø¨ ÙƒØ«Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙ„ ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ…. Ø§Ù†ØªØ¨Ù‡ Ù„Ù„Ø¬ÙØ§Ù."},
    en:{short:"Furosemide", hint:"Prefer early after Iftar to avoid nocturia. Watch dehydration."}
  },
  {k:"hydrochlorothiazide", names:["Hydrochlorothiazide","HCTZ","Ù‡ÙŠØ¯Ø±ÙˆÙƒÙ„ÙˆØ±ÙˆØ«ÙŠØ§Ø²ÙŠØ¯"], cat:"renal", freq:"OD", badge:"warn",
    ar:{short:"HCTZ (Ù…Ø¯Ø±)", hint:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù…Ø¨ÙƒØ±Ù‹Ø§ + Ø³ÙˆØ§Ø¦Ù„. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¯ÙˆØ®Ø©."},
    en:{short:"HCTZ", hint:"Early after Iftar + fluids. Monitor dizziness."}
  },
  {k:"spironolactone", names:["Spironolactone","Ø£Ù„Ø¯Ø§ÙƒØªÙˆÙ†","Ø³Ø¨ÙŠØ±ÙˆÙ†ÙˆÙ„Ø§ÙƒØªÙˆÙ†"], cat:"renal", freq:"OD", badge:"warn",
    ar:{short:"Ø³Ø¨ÙŠØ±ÙˆÙ†ÙˆÙ„Ø§ÙƒØªÙˆÙ†", hint:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ… Ø®ØµÙˆØµÙ‹Ø§ Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„ÙƒÙ„Ù‰."},
    en:{short:"Spironolactone", hint:"After Iftar. Monitor potassium especially in CKD."}
  },
  {k:"digoxin", names:["Digoxin","Ø¯ÙŠØ¬ÙˆÙƒØ³ÙŠÙ†"], cat:"htn", freq:"OD", badge:"warn",
    ar:{short:"Ø¯ÙŠØ¬ÙˆÙƒØ³ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ ÙˆÙ‚Øª Ø«Ø§Ø¨Øª (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±). Ø§Ù†ØªØ¨Ù‡ Ù„Ù„ØªØ¯Ø§Ø®Ù„Ø§Øª ÙˆØ§Ù„Ø¬Ø±Ø¹Ø©."},
    en:{short:"Digoxin", hint:"Once daily at fixed time after Iftar. Watch interactions/dose."}
  },

  /* ========= ANTIBIOTICS (examples + frequency logic) ========= */
  {k:"amoxicillin", names:["Amoxicillin","Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†"], cat:"abx", freq:"TID", badge:"warn",
    ar:{short:"Ø£Ù…ÙˆÙƒØ³ÙŠØ³ÙŠÙ„ÙŠÙ†", hint:"TID ÙŠØµØ¹Ø¨ Ù…Ø¹ Ø§Ù„ØµÙŠØ§Ù…. Ù†Ø§Ù‚Ø´ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¨Ø¯ÙŠÙ„ BID/OD Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©."},
    en:{short:"Amoxicillin", hint:"TID is hard during fasting. Ask clinician about BID/OD alternatives if appropriate."}
  },
  {k:"amox_clav", names:["Amoxicillin clavulanate","Augmentin","Ø£ÙˆØºÙ…Ù†ØªÙŠÙ†","ÙƒÙ„Ø§Ù"], cat:"abx", freq:"BID", badge:"ok",
    ar:{short:"Ø£ÙˆØºÙ…Ù†ØªÙŠÙ†", hint:"Ù…Ø±ØªÙŠÙ†: Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ± (Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù… Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ø¶Ø·Ø±Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ø©)."},
    en:{short:"Augmentin", hint:"BID: Iftar + Suhoor with food to reduce GI upset."}
  },
  {k:"azithromycin", names:["Azithromycin","Zithromax","Ø£Ø²ÙŠØ«Ø±ÙˆÙ…ÙŠØ³ÙŠÙ†","Ø²ÙŠØ«Ø±ÙˆÙ…Ø§ÙƒØ³"], cat:"abx", freq:"OD", badge:"ok",
    ar:{short:"Ø£Ø²ÙŠØ«Ø±ÙˆÙ…ÙŠØ³ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø«Ø¨Ù‘Øª Ø§Ù„ÙˆÙ‚Øª)."},
    en:{short:"Azithromycin", hint:"Once daily after Iftar; keep consistent."}
  },
  {k:"ciprofloxacin", names:["Ciprofloxacin","Ø³ÙŠØ¨Ø±ÙˆÙÙ„ÙˆÙƒØ³Ø§Ø³ÙŠÙ†","Cipro"], cat:"abx", freq:"BID", badge:"warn",
    ar:{short:"Ø³ÙŠØ¨Ø±ÙˆÙÙ„ÙˆÙƒØ³Ø§Ø³ÙŠÙ†", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ø§Ù„Ø­Ù„ÙŠØ¨/Ø§Ù„ÙƒØ§Ù„Ø³ÙŠÙˆÙ… Ø­ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø© (Ù‚Ø¯ ÙŠÙ‚Ù„ Ø§Ù„Ø§Ù…ØªØµØ§Øµ)."},
    en:{short:"Ciprofloxacin", hint:"Iftar + Suhoor. Avoid dairy/calcium near dose (absorption issue)."}
  },
  {k:"levofloxacin", names:["Levofloxacin","Ù„ÙŠÙÙˆÙÙ„ÙˆÙƒØ³Ø§Ø³ÙŠÙ†"], cat:"abx", freq:"OD", badge:"warn",
    ar:{short:"Ù„ÙŠÙÙˆÙÙ„ÙˆÙƒØ³Ø§Ø³ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±. Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†/Ø§Ù„Ø­Ø¯ÙŠØ¯ Ø­ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø©."},
    en:{short:"Levofloxacin", hint:"Once daily after Iftar. Separate from minerals/iron."}
  },

  /* ========= GI ========= */
  {k:"famotidine", names:["Famotidine","ÙØ§Ù…ÙˆØªÙŠØ¯ÙŠÙ†"], cat:"gi", freq:"OD", badge:"ok",
    ar:{short:"ÙØ§Ù…ÙˆØªÙŠØ¯ÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…."},
    en:{short:"Famotidine", hint:"Once daily before Iftar or at bedtime."}
  },
  {k:"mesalamine", names:["Mesalamine","Ù…ÙŠØ³Ø§Ù„Ø§Ø²ÙŠÙ†","Pentasa","Ø¨Ù†ØªØ§Ø³Ø§"], cat:"gi", freq:"BID", badge:"ok",
    ar:{short:"Ù…ÙŠØ³Ø§Ù„Ø§Ø²ÙŠÙ†", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù…ØªØ¯ Ù‚Ø¯ ÙŠÙƒÙÙŠ Ù…Ø±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¨."},
    en:{short:"Mesalamine", hint:"Iftar + Suhoor. Some ER forms may be once daily per clinician."}
  },

  /* ========= RESPIRATORY ========= */
  {k:"budesonide_formoterol", names:["Budesonide formoterol","Symbicort","Ø³ÙŠÙ…Ø¨ÙŠÙƒÙˆØ±Øª"], cat:"asthma", freq:"BID", route:"inhaled", badge:"ok",
    ar:{short:"Ø¨Ø®Ø§Ø® ÙˆÙ‚Ø§Ø¦ÙŠ (Ø³ÙŠÙ…Ø¨ÙŠÙƒÙˆØ±Øª)", hint:"Ø§Ù„Ø§Ø³ØªÙ†Ø´Ø§Ù‚ Ù„Ø§ ÙŠÙØ·Ø± ØºØ§Ù„Ø¨Ù‹Ø§. Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø®Ø·Ø© (ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡) ÙˆÙŠÙ…ÙƒÙ† Ø¬Ø¹Ù„Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± + Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…."},
    en:{short:"Controller inhaler (Symbicort)", hint:"Inhaled meds generally do not break fast. Use as prescribed; can align after Iftar + bedtime."}
  },

  /* ========= NEURO ========= */
  {k:"levetiracetam", names:["Levetiracetam","Keppra","Ù„ÙŠÙØ§ØªÙŠØ±Ø§Ø³ÙŠØªØ§Ù…","ÙƒÙŠØ¨Ø±Ø§"], cat:"neuro", freq:"BID", badge:"warn",
    ar:{short:"Ù„ÙŠÙØ§ØªÙŠØ±Ø§Ø³ÙŠØªØ§Ù…", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ù„Ø§ ØªÙÙˆÙ‚Ù Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙØ¬Ø£Ø©."},
    en:{short:"Levetiracetam", hint:"Iftar + Suhoor. Do not stop abruptly."}
  },
  {k:"valproate", names:["Valproate","Sodium valproate","Ø¯ÙŠØ¨Ø§ÙƒÙŠÙ†","ÙØ§Ù„Ø¨Ø±ÙˆØ§Øª"], cat:"neuro", freq:"BID", badge:"warn",
    ar:{short:"ÙØ§Ù„Ø¨Ø±ÙˆØ§Øª", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø±Ø§Ù‚Ø¨ Ø§Ø¶Ø·Ø±Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ø©."},
    en:{short:"Valproate", hint:"Iftar + Suhoor. Monitor GI upset."}
  },

  /* ========= PSYCH ========= */
  {k:"fluoxetine", names:["Fluoxetine","Prozac","ÙÙ„ÙˆÙƒØ³ÙŠØªÙŠÙ†","Ø¨Ø±ÙˆØ²Ø§Ùƒ"], cat:"psych", freq:"OD", badge:"ok",
    ar:{short:"ÙÙ„ÙˆÙƒØ³ÙŠØªÙŠÙ†", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ ØµØ¨Ø§Ø­Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­ÙˆØ± Ø­Ø³Ø¨ ØªØ£Ø«ÙŠØ±Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆÙ…."},
    en:{short:"Fluoxetine", hint:"Once daily after Iftar or after Suhoor depending on sleep effects."}
  },

  /* ========= THYROID ========= */
  {k:"carbimazole", names:["Carbimazole","Neomercazole","ÙƒØ§Ø±Ø¨Ù…ÙŠØ²ÙˆÙ„","Ù†ÙŠÙˆ Ù…ÙŠØ±ÙƒØ§Ø²ÙˆÙ„"], cat:"thyroid", freq:"BID", badge:"warn",
    ar:{short:"ÙƒØ§Ø±Ø¨Ù…ÙŠØ²ÙˆÙ„", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ±. Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©."},
    en:{short:"Carbimazole", hint:"Iftar + Suhoor. Keep labs and follow-up."}
  },

  /* ========= PAIN / INFLAMMATION ========= */
  {k:"naproxen", names:["Naproxen","Ù†Ø§Ø¨Ø±ÙˆÙƒØ³ÙŠÙ†"], cat:"pain", freq:"BID", badge:"warn",
    ar:{short:"Ù†Ø§Ø¨Ø±ÙˆÙƒØ³ÙŠÙ†", hint:"Ø¥ÙØ·Ø§Ø± + Ø³Ø­ÙˆØ± Ù…Ø¹ Ø§Ù„Ø·Ø¹Ø§Ù…. ØªØ¬Ù†Ø¨Ù‡ Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù‚Ø±Ø­Ø©/Ø§Ù„ÙƒÙ„Ù‰ Ø¥Ù„Ø§ Ø¨ØªÙˆØ¬ÙŠÙ‡ Ø·Ø¨ÙŠ."},
    en:{short:"Naproxen", hint:"Iftar + Suhoor with food. Avoid in ulcers/CKD unless advised."}
  },

  /* ========= STEROID / IMMUNO ========= */
  {k:"prednisone", names:["Prednisone","Prednisolone","Ø¨Ø±ÙŠØ¯Ù†ÙŠØ²ÙˆÙ†","Ø¨Ø±ÙŠØ¯Ù†ÙŠØ²ÙˆÙ„ÙˆÙ†"], cat:"steroid", freq:"OD", badge:"warn",
    ar:{short:"Ø¨Ø±ÙŠØ¯Ù†ÙŠØ²ÙˆÙ†", hint:"ÙŠÙØ¶Ù„ ØµØ¨Ø§Ø­Ù‹Ø§ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚â€”ÙÙŠ Ø±Ù…Ø¶Ø§Ù† ØºØ§Ù„Ø¨Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­ÙˆØ±. Ù„Ø§ ØªÙˆÙ‚ÙÙ‡ ÙØ¬Ø£Ø©."},
    en:{short:"Prednisone", hint:"Prefer morning to reduce insomnia; in Ramadan often after Suhoor. Do not stop abruptly."}
  },
  {k:"methotrexate", names:["Methotrexate","Ù…ÙŠØ«ÙˆØªØ±ÙƒØ³ÙŠØª"], cat:"steroid", freq:"WEEKLY", badge:"warn",
    ar:{short:"Ù…ÙŠØ«ÙˆØªØ±ÙƒØ³ÙŠØª Ø£Ø³Ø¨ÙˆØ¹ÙŠ", hint:"Ù„Ø§ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„ØµÙŠØ§Ù… Ø¹Ø§Ø¯Ø©Ù‹. ÙŠÙˆÙ… Ø«Ø§Ø¨Øª. Ø§Ù†ØªØ¨Ù‡ Ù„Ù„ØªØ¯Ø§Ø®Ù„Ø§Øª ÙˆØ­Ù…Ø¶ Ø§Ù„ÙÙˆÙ„ÙŠÙƒ Ø­Ø³Ø¨ Ø§Ù„ÙˆØµÙØ©."},
    en:{short:"Methotrexate weekly", hint:"Usually unaffected by fasting. Keep same weekday. Follow folic acid plan and interactions."}
  },

  /* ========= OTHER ========= */
  {k:"oral_contraceptive", names:["Oral contraceptive","Combined pill","Ø­Ø¨ÙˆØ¨ Ù…Ù†Ø¹ Ø§Ù„Ø­Ù…Ù„"], cat:"other", freq:"OD", badge:"ok",
    ar:{short:"Ø­Ø¨ÙˆØ¨ Ù…Ù†Ø¹ Ø§Ù„Ø­Ù…Ù„", hint:"Ù…Ø±Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ ÙˆÙ‚Øª Ø«Ø§Ø¨Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…."},
    en:{short:"Oral contraceptive", hint:"Once daily at fixed time after Iftar or bedtime."}
  },

  /* ========= Eye/Ear/Nasal examples (generally non-nutritive) ========= */
  {k:"eye_drops", names:["Eye drops","Ù‚Ø·Ø±Ø© Ø¹ÙŠÙ†"], cat:"other", freq:"PRN", route:"ophthalmic", badge:"ok",
    ar:{short:"Ù‚Ø·Ø±Ø© Ø¹ÙŠÙ†", hint:"ØºØ§Ù„Ø¨Ù‹Ø§ Ù„Ø§ ØªÙØ·Ø± (ÙƒÙ…ÙŠØ© ØµØºÙŠØ±Ø© Ù…ÙˆØ¶Ø¹ÙŠØ©). Ø¥Ø°Ø§ Ù†Ø²Ù„ Ø·Ø¹Ù… Ø¨Ø§Ù„Ø­Ù„Ù‚ Ù„Ø§ ØªÙƒØ±Ø± ÙƒØ«ÙŠØ±Ù‹Ø§."},
    en:{short:"Eye drops", hint:"Generally do not break fast (small topical amount). If taste in throat, avoid excess."}
  },
  {k:"nasal_spray", names:["Nasal spray","Ø¨Ø®Ø§Ø® Ø£Ù†Ù"], cat:"other", freq:"PRN", route:"nasal", badge:"warn",
    ar:{short:"Ø¨Ø®Ø§Ø® Ø£Ù†Ù", hint:"Ù‚Ø¯ ÙŠØµÙ„ Ù„Ù„Ø­Ù„Ù‚Ø› Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¥Ù† Ø£Ù…ÙƒÙ†."},
    en:{short:"Nasal spray", hint:"May reach throat; prefer after Iftar if possible."}
  }
];

/* ======= Exclusions (no creams/topicals) =======
We do NOT include:
- creams/ointments/gels/lotions (topical dermatologic)
If user searches them, we will respond with "topicals excluded" message.
============================================== */

const TOP_KEYS = new Set([
  "metformin","metformin_xr","amlodipine","losartan","valsartan","lisinopril",
  "atorvastatin","rosuvastatin","aspirin","clopidogrel","warfarin","rivaroxaban",
  "apixaban","omeprazole","pantoprazole","levothyroxine","sertraline","paracetamol",
  "ibuprofen","salbutamol"
]);

/* =========================
   Smart guidance engine
========================= */
function badgeLabel(b){
  if(lang==="ar"){
    return b==="ok" ? "Ø¢Ù…Ù† ØºØ§Ù„Ø¨Ù‹Ø§" : b==="warn" ? "Ø¨Ø­Ø°Ø±" : "Ø®Ø·Ø± Ù‡Ø¨ÙˆØ·/ÙŠØ­ØªØ§Ø¬ Ø·Ø¨ÙŠØ¨";
  }else{
    return b==="ok" ? "Generally OK" : b==="warn" ? "Use caution" : "High risk / clinician";
  }
}

function makePlan(m){
  // default plan template by freq & route
  const ar = {
    IFTAR:"Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±",
    SUHOOR:"Ù…Ø¹ Ø§Ù„Ø³Ø­ÙˆØ±",
    PREIFTAR:"Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ù€ 30â€“60 Ø¯Ù‚ÙŠÙ‚Ø©",
    BED:"Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",
    NOTE:"Ø«Ø¨Ù‘Øª Ø§Ù„ÙˆÙ‚Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†."
  };
  const en = {
    IFTAR:"After Iftar",
    SUHOOR:"With Suhoor",
    PREIFTAR:"30â€“60 min before Iftar",
    BED:"At bedtime",
    NOTE:"Keep timing consistent daily."
  };

  // route-based
  if(m.route==="inhaled"){
    return lang==="ar"
      ? `Ø§Ù„Ø§Ø³ØªÙ†Ø´Ø§Ù‚ Ø¹Ø§Ø¯Ø©Ù‹ Ù„Ø§ ÙŠÙØ·Ø±. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·Ø©ØŒ ÙˆÙŠÙ…ÙƒÙ† ØªÙ†Ø¸ÙŠÙ…Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± + Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…. ${ar.NOTE}`
      : `Inhaled meds generally do not break the fast. Use as prescribed; can align after Iftar + bedtime. ${en.NOTE}`;
  }
  if(m.route==="ophthalmic"){
    return lang==="ar"
      ? `Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ø¹ÙŠÙ† ØºØ§Ù„Ø¨Ù‹Ø§ Ù„Ø§ ØªÙØ·Ø± (ÙƒÙ…ÙŠØ© Ù…ÙˆØ¶Ø¹ÙŠØ© ØµØºÙŠØ±Ø©). Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©/Ø­Ø³Ø¨ Ø§Ù„ÙˆØµÙØ©.`
      : `Eye drops generally do not break the fast (small topical amount). Use as prescribed/needed.`;
  }
  if(m.route==="nasal"){
    return lang==="ar"
      ? `Ù‚Ø¯ ÙŠØµÙ„ Ø§Ù„Ø¨Ø®Ø§Ø® Ù„Ù„Ø­Ù„Ù‚Ø› Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¥Ù† Ø£Ù…ÙƒÙ†ØŒ Ø£Ùˆ Ø§Ø³ØªØ´Ø± Ø§Ù„Ù…ÙØªÙŠ/Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©.`
      : `Nasal sprays may reach the throat; prefer after Iftar if possible; consider clinician guidance.`;
  }

  // frequency logic
  if(m.freq==="OD"){
    // special for PPIs & thyroid already in hint; keep generic
    return (lang==="ar")
      ? `ØºØ§Ù„Ø¨Ù‹Ø§: ${ar.IFTAR} (Ø£Ùˆ ${ar.BED} Ø­Ø³Ø¨ Ø§Ù„ØªØ­Ù…Ù„). ${ar.NOTE}`
      : `Usually: ${en.IF}TAR?`; // (we'll fix below)
  }
  if(m.freq==="BID"){
    return lang==="ar"
      ? `Ù…Ø±ØªÙŠÙ† ÙŠÙˆÙ…ÙŠÙ‹Ø§: ${ar.IFTAR} + ${ar.SUHOOR}. ${ar.NOTE}`
      : `BID: After Iftar + With Suhoor. ${en.NOTE}`;
  }
  if(m.freq==="TID"){
    return lang==="ar"
      ? `Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ (TID): Ù‚Ø¯ Ù„Ø§ ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„ØµÙŠØ§Ù…. Ù†Ø§Ù‚Ø´ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¨Ø¯ÙŠÙ„ Ù…Ø±ØªÙŠÙ†/Ù…Ø±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©.`
      : `TID is difficult during fasting. Ask clinician about BID/OD alternatives when appropriate.`;
  }
  if(m.freq==="QID"){
    return lang==="ar"
      ? `Ø£Ø±Ø¨Ø¹ Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ (QID): ØºØ§Ù„Ø¨Ù‹Ø§ Ù„Ø§ ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„ØµÙŠØ§Ù…. ÙŠÙ„Ø²Ù… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø·Ø© Ø£Ùˆ ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆØ§Ø¡.`
      : `QID is generally not compatible with fasting; clinician review needed to adjust regimen.`;
  }
  if(m.freq==="WEEKLY"){
    return lang==="ar"
      ? `Ø£Ø³Ø¨ÙˆØ¹ÙŠ: Ø§Ø®ØªØ± ÙŠÙˆÙ…Ù‹Ø§ Ø«Ø§Ø¨ØªÙ‹Ø§ ÙˆÙˆÙ‚ØªÙ‹Ø§ Ø«Ø§Ø¨ØªÙ‹Ø§ (Ø¹Ø§Ø¯Ø©Ù‹ ${ar.IFTAR} Ø£Ùˆ ${ar.BED}).`
      : `Weekly: Keep a fixed weekday and time (often after Iftar or bedtime).`;
  }
  if(m.freq==="PRN"){
    return lang==="ar"
      ? `Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…: ${ar.IFTAR} Ø£Ùˆ ${ar.SUHOOR} Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ Ø§Ù„Ù…ÙˆØµÙˆÙØ©.`
      : `PRN: after Iftar or with Suhoor as needed; follow prescribed max daily dose.`;
  }
  // SPECIAL
  return (lang==="ar")
    ? `Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙŠØ­ØªØ§Ø¬ Ø®Ø·Ø© ÙØ±Ø¯ÙŠØ© ÙÙŠ Ø±Ù…Ø¶Ø§Ù† (Ø®ØµÙˆØµÙ‹Ø§ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª/Ø§Ù„Ø£Ù†Ø³ÙˆÙ„ÙŠÙ†). Ù„Ø§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¬Ø±Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¨/Ø§Ù„ØµÙŠØ¯Ù„ÙŠ.`
    : `This medication often needs an individualized Ramadan plan (dose-dependent). Do not change without clinician.`;
}

// Fix small typo above by handling OD english properly:
function planOD(){
  const en = "Usually: After Iftar (or at bedtime depending on tolerability). Keep timing consistent daily.";
  const ar = "ØºØ§Ù„Ø¨Ù‹Ø§: Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± (Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ… Ø­Ø³Ø¨ Ø§Ù„ØªØ­Ù…Ù„). Ø«Ø¨Ù‘Øª Ø§Ù„ÙˆÙ‚Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†.";
  return (lang==="ar"?ar:en);
}

function buildAdvice(m){
  // Critical box for high-risk groups
  const critical = [];
  const whenCall = [];

  // global triggers
  if(m.badge==="danger"){
    if(lang==="ar"){
      critical.push("Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ù‡Ø¨ÙˆØ· Ø³ÙƒØ±/Ù…Ø´Ø§ÙƒÙ„ Ø¥Ø°Ø§ ØªØºÙŠÙ‘Ø± ØªÙˆÙ‚ÙŠØªÙ‡ Ø£Ùˆ Ø¬Ø±Ø¹ØªÙ‡. Ù„Ø§ ØªØ¹Ø¯Ù‘Ù„ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø·Ø¨ÙŠØ¨.");
      whenCall.push("Ù‡Ø¨ÙˆØ· Ø³ÙƒØ± (ØªØ¹Ø±Ù‘Ù‚/Ø±Ø¬ÙØ©/Ø¯ÙˆØ®Ø©/Ø¥ØºÙ…Ø§Ø¡) Ø£Ùˆ Ø³ÙƒØ± Ù…Ù†Ø®ÙØ¶ Ø¨Ø§Ù„Ù‚ÙŠØ§Ø³.");
      whenCall.push("Ø³ÙƒØ± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ù‹Ø§ Ù…Ø¹ Ø¹Ø·Ø´ Ø´Ø¯ÙŠØ¯/Ù‚ÙŠØ¡/ØªØ¹Ø¨ Ø´Ø¯ÙŠØ¯.");
    }else{
      critical.push("This medication can be high-risk during fasting. Do not change dose/timing without clinician guidance.");
      whenCall.push("Hypoglycemia symptoms or low glucose readings.");
      whenCall.push("Very high glucose with dehydration/vomiting/severe fatigue.");
    }
  }

  // diuretics & dehydration
  if(["furosemide","hydrochlorothiazide","spironolactone"].includes(m.k) || m.cat==="renal"){
    if(lang==="ar"){
      whenCall.push("Ø¯ÙˆØ®Ø© Ø´Ø¯ÙŠØ¯Ø©/Ø¥ØºÙ…Ø§Ø¡/Ø¬ÙØ§Ù Ø£Ùˆ Ù‚Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙ„.");
    }else{
      whenCall.push("Severe dizziness/fainting/dehydration or very low urine output.");
    }
  }

  // anticoagulants
  if(m.cat==="anticoag"){
    if(lang==="ar"){
      whenCall.push("Ù†Ø²ÙŠÙ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ (Ù„Ø«Ø©/Ø¨ÙˆÙ„/Ø¨Ø±Ø§Ø² Ø£Ø³ÙˆØ¯/ÙƒØ¯Ù…Ø§Øª ÙƒØ«ÙŠØ±Ø©) Ø£Ùˆ ØµØ¯Ø§Ø¹ Ø´Ø¯ÙŠØ¯ Ù…ÙØ§Ø¬Ø¦.");
    }else{
      whenCall.push("Unusual bleeding/bruising, black stools, blood in urine, sudden severe headache.");
    }
  }

  // PPI/thyroid special notes: already in hints; add general empty stomach note
  if(m.k==="levothyroxine"){
    if(lang==="ar"){
      critical.push("Ù„ÙŠÙÙˆØ«ÙŠØ±ÙˆÙƒØ³ÙŠÙ† ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„Ø£ÙƒÙ„/Ø§Ù„ÙƒØ§Ù„Ø³ÙŠÙˆÙ…/Ø§Ù„Ø­Ø¯ÙŠØ¯â€”Ø§ØªØ±Ùƒ ÙØ§ØµÙ„Ù‹Ø§ Ù…Ù†Ø§Ø³Ø¨Ù‹Ø§.");
    }else{
      critical.push("Levothyroxine absorption is affected by food, calcium, ironâ€”separate appropriately.");
    }
  }

  // plan text
  let planText;
  if(m.freq==="OD"){
    planText = planOD();
  }else{
    planText = makePlan(m);
  }

  // details combine
  const details = [];
  if(lang==="ar"){
    details.push(m.ar?.hint || "");
    details.push("Ù†ØµÙŠØ­Ø©: Ø§Ø´Ø±Ø¨ Ø³ÙˆØ§Ø¦Ù„ ÙƒØ§ÙÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±ØŒ ÙˆØªØ¬Ù†Ù‘Ø¨ Ø£Ø®Ø° Ø£Ø¯ÙˆÙŠØ© Ù…ÙØ¯Ø±Ù‘Ø© Ù‚Ø±Ø¨ Ø§Ù„Ù†ÙˆÙ… Ø¥Ù† Ø£Ù…ÙƒÙ†.");
    details.push("Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù…Ù…ØªØ¯ Ø§Ù„Ù…ÙØ¹ÙˆÙ„ (XR/ER) Ù‚Ø¯ ØªØ®ØªÙ„Ù Ø§Ù„Ø®Ø·Ø©â€”Ø§ØªØ¨Ø¹ Ø§Ù„ÙˆØµÙØ©.");
  }else{
    details.push(m.en?.hint || "");
    details.push("Tip: Hydrate well between Iftar and Suhoor; avoid diuretics close to bedtime when possible.");
    details.push("Extended-release (XR/ER) formulations may differâ€”follow your prescription.");
  }

  // remove blanks
  const clean = (arr)=>arr.filter(x=>String(x||"").trim().length>0);
  return {
    critical: clean(critical).join(" "),
    plan: planText,
    details: clean(details).join(" "),
    whenCall: clean(whenCall).join(" â€¢ ")
  };
}

/* =========================
   Search, list rendering
========================= */
let currentMode = "top"; // "top" | "cats" | "safety" | "search"
let currentList = [];

function normalize(s){
  return (s||"")
    .toLowerCase()
    .replace(/\s+/g," ")
    .replace(/[^\p{L}\p{N}\s\/\-\+\.]/gu,"")
    .trim();
}

function isTopicalQuery(q){
  // user asked to remove creams/topicals
  const bad = ["cream","ointment","gel","lotion","Ù…Ø±Ù‡Ù…","ÙƒØ±ÙŠÙ…","Ø¬Ù„","Ù„ÙˆØ´Ù†"];
  const n = normalize(q);
  return bad.some(w=>n.includes(w));
}

function filterMeds(query){
  const nq = normalize(query);
  if(!nq) return [];
  return MEDS.filter(m=>{
    const all = (m.names||[]).join(" ");
    const hay = normalize(all + " " + (m.ar?.short||"") + " " + (m.en?.short||""));
    return hay.includes(nq);
  });
}

function renderChips(mode){
  const chips = $("chips");
  chips.innerHTML = "";

  if(mode==="top"){
    // show category shortcuts
    CATS.slice(1).forEach(c=>{
      const d=document.createElement("div");
      d.className="chip";
      d.textContent = (lang==="ar"?c.ar:c.en);
      d.onclick=()=>showCategory(c.id);
      chips.appendChild(d);
    });
    return;
  }

  if(mode==="cats"){
    CATS.slice(1).forEach(c=>{
      const d=document.createElement("div");
      d.className="chip";
      d.textContent = (lang==="ar"?c.ar:c.en);
      d.onclick=()=>showCategory(c.id);
      chips.appendChild(d);
    });
    return;
  }

  if(mode==="safety"){
    const safetyChips = [
      {id:"diabetesHigh", ar:"ğŸ©¸ Ø³ÙƒØ±ÙŠ (Ù…Ù‡Ù…)", en:"ğŸ©¸ Diabetes (important)"},
      {id:"anticoag", ar:"ğŸ©¸ Ø³ÙŠÙˆÙ„Ø©/Ù†Ø²ÙŠÙ", en:"ğŸ©¸ Blood thinners"},
      {id:"renal", ar:"ğŸ’§ Ø¬ÙØ§Ù/Ù…Ø¯Ø±Ø§Øª", en:"ğŸ’§ Dehydration/diuretics"},
      {id:"whenbreak", ar:"ğŸ›‘ Ù…ØªÙ‰ Ø£ÙØ·Ø±ØŸ", en:"ğŸ›‘ When to break fast?"},
      {id:"nonoral", ar:"ğŸ’¨ Ù‡Ù„ Ø§Ù„Ø¨Ø®Ø§Ø® ÙŠÙØ·Ø±ØŸ", en:"ğŸ’¨ Do inhalers break fast?"}
    ];
    safetyChips.forEach(c=>{
      const d=document.createElement("div");
      d.className="chip";
      d.textContent=(lang==="ar"?c.ar:c.en);
      d.onclick=()=>showSafety(c.id);
      chips.appendChild(d);
    });
    return;
  }

  // search mode shows quick category chips:
  CATS.slice(1).forEach(c=>{
    const d=document.createElement("div");
    d.className="chip";
    d.textContent=(lang==="ar"?c.ar:c.en);
    d.onclick=()=>showCategory(c.id);
    chips.appendChild(d);
  });
}

function renderList(list){
  currentList = list;
  const el = $("list");
  el.innerHTML = "";
  if(!list || list.length===0){
    const empty=document.createElement("div");
    empty.className="note";
    empty.textContent=T[lang].noResults;
    el.appendChild(empty);
    return;
  }
  list.forEach(m=>{
    const item=document.createElement("div");
    item.className="item";
    const badge=document.createElement("div");
    badge.className="badge " + (m.badge==="ok"?"ok":m.badge==="warn"?"warn":"danger");
    badge.textContent = badgeLabel(m.badge);
    const top=document.createElement("div");
    top.className="top";
    const left=document.createElement("div");
    const name=document.createElement("div");
    name.className="name";
    name.textContent = (lang==="ar" ? (m.ar?.short || m.names[0]) : (m.en?.short || m.names[0]));
    const meta=document.createElement("div");
    meta.className="meta";
    const catName = CATS.find(c=>c.id===m.cat);
    meta.textContent = (lang==="ar" ? `Ø§Ù„ØªØµÙ†ÙŠÙ: ${catName?catName.ar:""} â€¢ Ø§Ù„ØªÙƒØ±Ø§Ø±: ${m.freq}` : `Category: ${catName?catName.en:""} â€¢ Frequency: ${m.freq}`);
    left.appendChild(name); left.appendChild(meta);
    top.appendChild(left); top.appendChild(badge);
    item.appendChild(top);
    item.onclick=()=>selectMed(m);
    el.appendChild(item);
  });
}

function selectMed(m){
  $("statusBadge").textContent = badgeLabel(m.badge);
  $("statusBadge").className = "badge " + (m.badge==="ok"?"ok":m.badge==="warn"?"warn":"danger");

  const adv = buildAdvice(m);

  // show boxes
  $("criticalBox").style.display = adv.critical ? "block":"none";
  $("criticalP").textContent = adv.critical || "";

  $("planBox").style.display = "block";
  $("planP").textContent = adv.plan;

  $("detailsBox").style.display = "block";
  $("detailsP").textContent = adv.details;

  $("whenCallBox").style.display = (adv.whenCall ? "block":"none");
  $("whenCallP").textContent = adv.whenCall || "";

  // scroll into view on mobile
  if(window.innerWidth<980){
    $("answer").scrollIntoView({behavior:"smooth", block:"start"});
  }
}

/* =========================
   Modes
========================= */
function showTop(){
  currentMode="top";
  const topList = MEDS.filter(m=>TOP_KEYS.has(m.k));
  renderChips("top");
  renderList(topList);
}

function showCategories(){
  currentMode="cats";
  renderChips("cats");
  // default show all categories items limited
  const list = MEDS.slice().sort((a,b)=> (a.cat>b.cat?1:-1));
  renderList(list);
}

function showCategory(catId){
  currentMode="cats";
  renderChips("cats");
  const list = MEDS.filter(m=>m.cat===catId);
  renderList(list);
}

function showSafety(topic){
  currentMode="safety";
  renderChips("safety");

  // render as pseudo list items that open structured safety cards
  const items = [];
  if(topic==="diabetesHigh"){
    items.push({
      k:"safety_dm",
      names:["Safety: Diabetes"],
      cat:"other", freq:"INFO", badge:"danger",
      ar:{short:"ğŸ©¸ Ø§Ù„Ø³ÙƒØ±ÙŠ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† (Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§)", hint:"Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø£Ø®Ø·Ø±: Ø§Ù„Ø£Ù†Ø³ÙˆÙ„ÙŠÙ† ÙˆØ§Ù„Ø³Ù„ÙÙˆÙ†ÙŠÙ„ ÙŠÙˆØ±ÙŠØ§. ÙŠÙ„Ø²Ù… Ø®Ø·Ø© ÙØ±Ø¯ÙŠØ© ÙˆÙ‚ÙŠØ§Ø³ Ø³ÙƒØ±. Ù‚Ø¯ ÙŠÙ„Ø²Ù… ÙƒØ³Ø± Ø§Ù„ØµÙŠØ§Ù… Ø¹Ù†Ø¯ Ù‡Ø¨ÙˆØ· Ø§Ù„Ø³ÙƒØ±."},
      en:{short:"ğŸ©¸ Diabetes in Ramadan (Important)", hint:"Highest risk: insulin and sulfonylureas. Requires individualized plan + SMBG. Break the fast if hypoglycemia occurs."}
    });
  }
  if(topic==="anticoag"){
    items.push({
      k:"safety_anticoag",
      names:["Safety: Anticoagulation"],
      cat:"other", freq:"INFO", badge:"warn",
      ar:{short:"ğŸ©¸ Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©/Ø§Ù„ØªØ¬Ù„Ø·", hint:"Ø®Ø° Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¨ÙˆÙ‚Øª Ø«Ø§Ø¨Øª (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± ØºØ§Ù„Ø¨Ù‹Ø§). Ù„Ø§ ØªÙˆÙ‚ÙÙ‡. Ø±Ø§Ù‚Ø¨ Ø£ÙŠ Ù†Ø²ÙŠÙ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ."},
      en:{short:"ğŸ©¸ Blood thinners", hint:"Take at a fixed time (often after Iftar). Do not stop. Watch for bleeding."}
    });
  }
  if(topic==="renal"){
    items.push({
      k:"safety_renal",
      names:["Safety: Dehydration"],
      cat:"other", freq:"INFO", badge:"warn",
      ar:{short:"ğŸ’§ Ø§Ù„Ø¬ÙØ§Ù ÙˆØ§Ù„Ù…Ø¯Ø±Ø§Øª", hint:"Ø§Ù„Ù…Ø¯Ø±Ø§Øª Ù‚Ø¯ ØªØ²ÙŠØ¯ Ø§Ù„Ø¬ÙØ§Ù. ÙŠÙÙØ¶Ù‘Ù„ ØªÙ†Ø§ÙˆÙ„Ù‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ù…Ø¨ÙƒØ±Ù‹Ø§ + Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±."},
      en:{short:"ğŸ’§ Dehydration & diuretics", hint:"Diuretics can worsen dehydration. Prefer early after Iftar + hydrate well between Iftar and Suhoor."}
    });
  }
  if(topic==="whenbreak"){
    items.push({
      k:"safety_break",
      names:["Safety: Break fast"],
      cat:"other", freq:"INFO", badge:"danger",
      ar:{short:"ğŸ›‘ Ù…ØªÙ‰ ÙŠØ¬Ø¨ ÙƒØ³Ø± Ø§Ù„ØµÙŠØ§Ù…ØŸ", hint:"Ø¹Ù†Ø¯ Ù‡Ø¨ÙˆØ· Ø§Ù„Ø³ÙƒØ±ØŒ Ø¥ØºÙ…Ø§Ø¡/Ø¯ÙˆØ®Ø© Ø´Ø¯ÙŠØ¯Ø©ØŒ Ù†Ø²ÙŠÙ Ø´Ø¯ÙŠØ¯ØŒ Ø£Ù„Ù… ØµØ¯Ø±ÙŠØŒ Ø¶ÙŠÙ‚ Ù†ÙØ³ Ø´Ø¯ÙŠØ¯ØŒ Ø£Ùˆ Ù‚ÙŠØ¡ Ù…Ø³ØªÙ…Ø±/Ø¬ÙØ§Ù Ø´Ø¯ÙŠØ¯."},
      en:{short:"ğŸ›‘ When to break the fast?", hint:"Hypoglycemia, fainting/severe dizziness, heavy bleeding, chest pain, severe shortness of breath, persistent vomiting or severe dehydration."}
    });
  }
  if(topic==="nonoral"){
    items.push({
      k:"safety_nonoral",
      names:["Safety: Non-oral routes"],
      cat:"other", freq:"INFO", badge:"ok",
      ar:{short:"ğŸ’¨ Ù‡Ù„ Ø§Ù„Ø¨Ø®Ø§Ø®/Ø§Ù„Ù‚Ø·Ø±Ø§Øª ØªÙØ·Ø±ØŸ", hint:"ØºØ§Ù„Ø¨Ù‹Ø§: Ø§Ù„Ø¨Ø®Ø§Ø®Ø§Øª Ø§Ù„Ø§Ø³ØªÙ†Ø´Ø§Ù‚ÙŠØ© ÙˆÙ‚Ø·Ø±Ø§Øª Ø§Ù„Ø¹ÙŠÙ† Ù„Ø§ ØªÙØ·Ø± (Ù…ÙˆØ¶Ø¹ÙŠ). Ø¨Ø®Ø§Ø® Ø§Ù„Ø£Ù†Ù Ù‚Ø¯ ÙŠØµÙ„ Ù„Ù„Ø­Ù„Ù‚Ø› ÙŠÙØ¶Ù‘Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¥Ù† Ø£Ù…ÙƒÙ†."},
      en:{short:"ğŸ’¨ Do inhalers/drops break fast?", hint:"Generally: inhalers and eye drops do not break fast. Nasal sprays may reach the throat; prefer after Iftar if possible."}
    });
  }

  renderList(items);
}

function doSearch(){
  const q = $("q").value || "";
  if(isTopicalQuery(q)){
    renderChips("search");
    renderList([]);
    // show a clear message
    $("statusBadge").textContent = (lang==="ar" ? "Ù…Ø³ØªØ¨Ø¹Ø¯" : "Excluded");
    $("statusBadge").className = "badge warn";
    $("criticalBox").style.display="block";
    $("criticalP").textContent = (lang==="ar"
      ? "ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒØ±ÙŠÙ…Ø§Øª/Ø§Ù„Ù…Ø±Ø§Ù‡Ù…/Ø§Ù„Ø¬Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø¯ÙˆØ§Ø¡ ÙÙ…ÙˆÙŠ/Ø­Ù‚Ù†/Ø¨Ø®Ø§Ø® Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ù‡."
      : "Topical creams/ointments/gels were excluded as requested. Search for oral/injectable/inhaled medicines.");
    $("planBox").style.display="none";
    $("detailsBox").style.display="none";
    $("whenCallBox").style.display="none";
    return;
  }

  currentMode="search";
  renderChips("search");
  const list = filterMeds(q);
  renderList(list);
}

function clearAll(){
  $("q").value="";
  showTop();
  $("statusBadge").textContent=T[lang].ready;
  $("statusBadge").className="badge ok";
  $("criticalBox").style.display="none";
  $("planBox").style.display="none";
  $("detailsBox").style.display="none";
  $("whenCallBox").style.display="none";
}

/* =========================
   Events
========================= */
$("btnTop").onclick = showTop;
$("btnCats").onclick = showCategories;
$("btnSafety").onclick = ()=>showSafety("diabetesHigh");
$("btnSearch").onclick = doSearch;
$("btnClear").onclick = clearAll;
$("q").addEventListener("keydown",(e)=>{ if(e.key==="Enter") doSearch(); });

$("btnLang").onclick = ()=>{
  lang = (lang==="ar" ? "en" : "ar");
  applyLang();
};

function init(){
  applyLang();
  showTop();
}
init();
</script>
</body>
</html>
