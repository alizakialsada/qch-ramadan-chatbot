
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QCH ‚Äì Smart Ramadan Medication Assistant (v6)</title>
  <meta name="description" content="Qatif Central Hospital ‚Äì Ramadan Medication Assistant (Arabic/English). Hospital-grade class + frequency rules." />
  <style>
    :root{
      --bg:#0b1f26; --text:#eaf6fb; --muted:#b7d2dd;
      --accent:#35d0c7; --accent2:#2aa6ff;
      --danger:#ff4d4f; --warn:#f5a524; --ok:#22c55e;
      --radius:18px; --shadow: 0 10px 30px rgba(0,0,0,.35);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
    }
    body{margin:0;background:radial-gradient(1200px 700px at 20% 10%, #15404d 0%, var(--bg) 55%);color:var(--text);}
    .wrap{max-width:1220px;margin:24px auto;padding:16px}
    .top{background:linear-gradient(135deg,#123747,#0d2a34);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:var(--shadow);
      padding:18px;display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:54px;height:54px;border-radius:16px;background:linear-gradient(135deg,var(--accent2),var(--accent));
      display:grid;place-items:center;font-weight:900;box-shadow:0 10px 20px rgba(0,0,0,.25)}
    .title h1{margin:0;font-size:18px;letter-spacing:.2px}
    .title p{margin:4px 0 0;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select, button, input{
      background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--text);
      padding:10px 12px;border-radius:14px;outline:none;font-size:13px
    }
    button{cursor:pointer;background:rgba(53,208,199,.14);border-color:rgba(53,208,199,.35)}
    button:hover{filter:brightness(1.06)}
    .grid{margin-top:16px;display:grid;grid-template-columns:1.45fr .75fr;gap:16px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.10);
      border-radius:18px;box-shadow:var(--shadow);overflow:hidden;min-height:560px;display:flex;flex-direction:column}
    .card header{padding:14px 16px;background:rgba(0,0,0,.15);border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;align-items:center;justify-content:space-between;gap:10px}
    .badge{font-size:12px;color:var(--muted);padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px}
    .pillrow{display:flex;flex-wrap:wrap;gap:8px;padding:14px 16px 0}
    .pill{font-size:12px;color:var(--text);padding:8px 10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);
      border-radius:999px;cursor:pointer;user-select:none}
    .pill:hover{border-color:rgba(53,208,199,.45)}
    .chatlog{padding:16px;overflow:auto;flex:1;-webkit-overflow-scrolling:touch}
    .msg{display:flex;margin:10px 0}
    .msg .bubble{max-width:88%;padding:12px;border-radius:16px;line-height:1.35;font-size:14px;border:1px solid rgba(255,255,255,.10);white-space:pre-wrap}
    .me{justify-content:flex-end}
    .me .bubble{background:rgba(53,208,199,.16);border-color:rgba(53,208,199,.35)}
    .bot .bubble{background:rgba(255,255,255,.06)}
    .chips{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.12);color:rgba(234,246,251,.92)}
    .chip.ok{border-color:rgba(34,197,94,.45)}
    .chip.warn{border-color:rgba(245,165,36,.45)}
    .chip.danger{border-color:rgba(255,77,79,.45)}
    .composer{position:sticky;bottom:0;z-index:50;display:flex;gap:10px;padding:12px;background:rgba(8,18,22,.72);
      border-top:1px solid rgba(255,255,255,.08);backdrop-filter: blur(10px)}
    .composer input{flex:1;font-size:14px;pointer-events:auto}
    .side .content{padding:16px;color:var(--muted);font-size:13px;line-height:1.5}
    .alert{margin-top:10px;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05)}
    .alert.ok{border-color:rgba(34,197,94,.45)}
    .alert.warn{border-color:rgba(245,165,36,.45)}
    .alert.danger{border-color:rgba(255,77,79,.45)}
    .foot{margin-top:14px;font-size:12px;color:rgba(234,246,251,.75)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">QCH</div>
        <div class="title">
          <h1>QCH ‚Äì Smart Ramadan Medication Assistant</h1>
          <p>Hospital-grade rules: medication + class + frequency ‚Ä¢ Arabic / English</p>
        </div>
      </div>
      <div class="controls">
        <select id="lang">
          <option value="bi" selected>Arabic + English</option>
          <option value="ar">Arabic</option>
          <option value="en">English</option>
        </select>
        <select id="mode">
          <option value="patient" selected>Patient</option>
          <option value="hcp">Healthcare Staff</option>
        </select>
        <button id="reset" type="button">Reset</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <header>
          <div style="font-weight:800">Chat</div>
          <div class="badge">Ramadan ‚Ä¢ v6 (Class + Frequency Engine)</div>
        </header>

        <div class="pillrow" id="quick"></div>
        <div class="chatlog" id="chat"></div>

        <div class="composer">
          <input id="input" type="text" inputmode="text" autocapitalize="off" autocorrect="off"
                 placeholder="Type medication name‚Ä¶ / ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ÿßŸÑÿØŸàÿßÿ°‚Ä¶" autocomplete="off" />
          <button id="send" type="button">Send</button>
        </div>
      </section>

      <aside class="card side">
        <header>
          <div style="font-weight:800">Safety & How to use</div>
          <div class="badge">No PHI stored</div>
        </header>
        <div class="content">
          <div class="alert warn">
            <b>Important:</b> General guidance only. For <b>insulin</b>, <b>warfarin</b>, <b>pregnancy</b>, <b>CKD/CLD</b>,
            transplant, chemotherapy, seizure meds, or complex regimens ‚Üí consult your clinician/pharmacist.
          </div>

          <div class="alert ok" id="welcomeBox"></div>

          <div class="alert">
            <b>Perfect Ramadan method:</b><br/>
            1) Type the medication name. If not found ‚Üí type a <b>class</b> (e.g., <span class="mono">antibiotic</span>, <span class="mono">PPI</span>, <span class="mono">blood pressure</span>).<br/>
            2) If still unknown, the assistant will ask: <b>How many times per day?</b> (OD/BID/TID/QID).<br/>
            3) Follow the timing and the warning labels (‚õî/‚ö†Ô∏è/‚úÖ).
          </div>

          <div class="foot">
            Created by <b>Ali Alsada</b><br/>
            Pharmacy Department ‚Ä¢ Qatif Central Hospital
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
(() => {
  const ui = {
    lang: document.getElementById('lang'),
    mode: document.getElementById('mode'),
    reset: document.getElementById('reset'),
    chat: document.getElementById('chat'),
    input: document.getElementById('input'),
    send: document.getElementById('send'),
    quick: document.getElementById('quick'),
    welcomeBox: document.getElementById('welcomeBox'),
  };

  function t(ar,en){
    const L = ui.lang.value;
    if(L==="ar") return ar;
    if(L==="en") return en;
    return ar + "\n\n" + en;
  }
  function pushMsg(text, who="bot", chips=[]){
    const row = document.createElement("div");
    row.className = "msg " + (who==="me" ? "me":"bot");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = text;
    if(chips && chips.length){
      const c = document.createElement("div");
      c.className = "chips";
      chips.forEach(ch=>{
        const s = document.createElement("span");
        s.className = "chip " + (ch.level||"");
        s.textContent = t(ch.ar, ch.en);
        c.appendChild(s);
      });
      bubble.appendChild(c);
    }
    row.appendChild(bubble);
    ui.chat.appendChild(row);
    ui.chat.scrollTop = ui.chat.scrollHeight;
  }
  function normalize(s){
    return (s||"").toLowerCase().replace(/\s+/g," ").trim();
  }
  function chips(list){ return (list||[]).map(x=>({level:x.l, ar:x.ar, en:x.en})); }

  function freqGuidance(freq){
    if(freq==="od"){
      return {
        en: "‚úÖ Once daily (OD): take after Iftar.\n‚Ä¢ If empty-stomach medicine: take 30‚Äì60 min before Suhoor (water only).\n‚Ä¢ Keep the same time every day.",
        ar: "‚úÖ ŸÖÿ±ÿ© ŸäŸàŸÖŸäŸãÿß (OD): ÿÆÿ∞Ÿáÿß ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.\n‚Ä¢ ÿ•ÿ∞ÿß ÿØŸàÿßÿ° ÿπŸÑŸâ ŸÖÿπÿØÿ© ŸÅÿßÿ±ÿ∫ÿ©: ÿÆÿ∞Ÿá ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ± 30‚Äì60 ÿØŸÇŸäŸÇÿ© (ŸÖÿßÿ° ŸÅŸÇÿ∑).\n‚Ä¢ ÿ´ÿ®Ÿëÿ™ ŸÜŸÅÿ≥ ÿßŸÑŸàŸÇÿ™ ŸäŸàŸÖŸäŸãÿß.",
        chips: chips([{l:"ok",ar:"ÿ´ÿ®Ÿëÿ™ ÿßŸÑŸàŸÇÿ™ ŸäŸàŸÖŸäŸãÿß",en:"Keep timing consistent"}])
      };
    }
    if(freq==="bid"){
      return {
        en: "‚úÖ Twice daily (BID): 1st dose after Iftar + 2nd dose after Suhoor (as close to 12 hours apart as possible).\n‚Ä¢ If one dose must be with food: take it with Iftar.",
        ar: "‚úÖ ŸÖÿ±ÿ™ŸäŸÜ ŸäŸàŸÖŸäŸãÿß (BID): ÿßŸÑÿ¨ÿ±ÿπÿ© ÿßŸÑÿ£ŸàŸÑŸâ ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ÿßŸÑÿ´ÿßŸÜŸäÿ© ÿ®ÿπÿØ ÿßŸÑÿ≥ÿ≠Ÿàÿ± (ŸÇÿ±Ÿäÿ® ŸÖŸÜ 12 ÿ≥ÿßÿπÿ© ŸÇÿØÿ± ÿßŸÑÿ•ŸÖŸÉÿßŸÜ).\n‚Ä¢ ÿ•ÿ∞ÿß ÿ¨ÿ±ÿπÿ© ŸÑÿßÿ≤ŸÖ ŸÖÿπ ÿßŸÑÿ£ŸÉŸÑ: ÿÆÿ∞Ÿáÿß ŸÖÿπ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.",
        chips: chips([{l:"ok",ar:"ÿ•ŸÅÿ∑ÿßÿ± + ÿ≥ÿ≠Ÿàÿ±",en:"Iftar + Suhoor"}])
      };
    }
    if(freq==="tid"){
      return {
        en: "‚ö† Three times daily (TID): usually not ideal in Ramadan.\n‚úÖ Best option: ask your clinician to switch to BID or extended‚Äërelease (XR) during Ramadan.\n‚õî Do NOT self‚Äëadjust.",
        ar: "‚ö† ÿ´ŸÑÿßÿ´ ŸÖÿ±ÿßÿ™ ŸäŸàŸÖŸäŸãÿß (TID): ÿ∫ÿßŸÑÿ®Ÿãÿß ÿ∫Ÿäÿ± ŸÖŸÜÿßÿ≥ÿ® ŸÅŸä ÿ±ŸÖÿ∂ÿßŸÜ.\n‚úÖ ÿßŸÑÿ£ŸÅÿ∂ŸÑ: ÿßÿ≥ÿ™ÿ¥ÿ± ÿßŸÑÿ∑ÿ®Ÿäÿ® ŸÑÿ™ÿ≠ŸàŸäŸÑŸá ÿ•ŸÑŸâ ŸÖÿ±ÿ™ŸäŸÜ ÿ£Ÿà ŸÖŸÖÿ™ÿØ ÿßŸÑŸÖŸÅÿπŸàŸÑ (XR) ÿÆŸÑÿßŸÑ ÿ±ŸÖÿ∂ÿßŸÜ.\n‚õî ŸÑÿß ÿ™ÿπÿØŸëŸÑ ÿßŸÑÿ¨ÿ±ÿπÿßÿ™ ÿ®ŸÜŸÅÿ≥ŸÉ.",
        chips: chips([{l:"warn",ar:"ŸäŸÅÿ∂ŸÑ ÿ™ÿ≠ŸàŸäŸÑŸá",en:"Prefer switch to BID/XR"},{l:"danger",ar:"ŸÑÿß ÿ™ÿπÿØŸÑ ÿ®ŸÜŸÅÿ≥ŸÉ",en:"Do not self-adjust"}])
      };
    }
    return {
      en: "‚õî Four times daily (QID): not compatible with fasting safely for most meds.\nConsult your clinician for an alternative schedule.",
      ar: "‚õî ÿ£ÿ±ÿ®ÿπ ŸÖÿ±ÿßÿ™ ŸäŸàŸÖŸäŸãÿß (QID): ÿ∫ÿßŸÑÿ®Ÿãÿß ÿ∫Ÿäÿ± ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑÿµŸäÿßŸÖ ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ.\nÿßÿ≥ÿ™ÿ¥ÿ± ÿßŸÑÿ∑ÿ®Ÿäÿ® ŸÑÿ®ÿØŸäŸÑ ÿ£Ÿà ÿ¨ÿØŸàŸÑ ŸÖÿÆÿ™ŸÑŸÅ.",
      chips: chips([{l:"danger",ar:"ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿ∂ÿ±Ÿàÿ±Ÿäÿ©",en:"Consultation required"}])
    };
  }

  function entry(keys, catEn, catAr, patEn, patAr, ch=[], hcpObj=null){
    return {keys: keys.map(normalize), cat:{en:catEn, ar:catAr}, patient:{en:patEn, ar:patAr}, chips:ch, hcp:hcpObj};
  }
  function hcp(en, ar){ return {en, ar}; }
  function classRule(keys, catEn, catAr, patEn, patAr, ch=[]){
    return {keys: keys.map(normalize), cat:{en:catEn, ar:catAr}, patient:{en:patEn, ar:patAr}, chips:ch};
  }

  const MEDS = [
    entry(["warfarin","coumadin","Ÿàÿßÿ±ŸÅÿßÿ±ŸäŸÜ","ŸÉŸàŸÖÿßÿØŸäŸÜ"], "Anticoagulant", "ŸÖÿ∂ÿßÿØ ÿ™ÿÆÿ´ÿ±",
      "‚úÖ Take after Iftar at the same time daily.\n‚õî Do not change dose.\nüìå INR monitoring as scheduled.",
      "‚úÖ ÿÆÿ∞Ÿá ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸÅŸä ŸÜŸÅÿ≥ ÿßŸÑŸàŸÇÿ™ ŸäŸàŸÖŸäŸãÿß.\n‚õî ŸÑÿß ÿ™ÿ∫ŸäŸëÿ± ÿßŸÑÿ¨ÿ±ÿπÿ©.\nüìå ŸÖÿ™ÿßÿ®ÿπÿ© INR ÿ≠ÿ≥ÿ® ÿßŸÑÿÆÿ∑ÿ©.",
      chips([{l:"danger",ar:"Ÿàÿßÿ±ŸÅÿßÿ±ŸäŸÜ Ÿäÿ≠ÿ™ÿßÿ¨ INR",en:"Warfarin needs INR monitoring"},{l:"warn",ar:"ÿ™ÿØÿßÿÆŸÑÿßÿ™ ŸÖÿπ ŸÖÿ∂ÿßÿØÿßÿ™/NSAIDs",en:"Interactions with antibiotics/NSAIDs"}]),
      hcp("Keep time consistent; monitor INR with diet/drug changes.","ÿ´ÿ®Ÿëÿ™ ŸàŸÇÿ™ ÿßŸÑÿ¨ÿ±ÿπÿ© Ÿàÿ±ÿßŸÇÿ® INR ŸÖÿπ ÿ£Ÿä ÿ™ÿ∫ŸäŸäÿ± ÿ∫ÿ∞ÿßÿ¶Ÿä/ÿØŸàÿßÿ¶Ÿä.")
    ),
    entry(["apixaban","eliquis","ÿ£ÿ®ŸäŸÉÿ≥ÿßÿ®ÿßŸÜ","ÿßŸÑŸäŸÉŸàÿ≥"], "DOAC", "ŸÖÿ∂ÿßÿØ ÿ™ÿÆÿ´ÿ± (DOAC)",
      "‚úÖ BID: after Iftar + after Suhoor (‚âà12h apart).",
      "‚úÖ ŸÖÿ±ÿ™ŸäŸÜ: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ÿ®ÿπÿØ ÿßŸÑÿ≥ÿ≠Ÿàÿ± (‚âà12 ÿ≥ÿßÿπÿ©).",
      chips([{l:"warn",ar:"ÿ±ÿßŸÇÿ® ÿßŸÑŸÜÿ≤ŸäŸÅ",en:"Monitor bleeding"}])
    ),
    entry(["rivaroxaban","xarelto","ÿ±ŸäŸÅÿßÿ±ŸàŸÉÿ≥ÿßÿ®ÿßŸÜ","ÿ≤ÿßÿ±ŸÑÿ™Ÿà"], "DOAC", "ŸÖÿ∂ÿßÿØ ÿ™ÿÆÿ´ÿ± (DOAC)",
      "‚úÖ OD: after Iftar.\nüçΩ Some strengths must be taken with food (follow label).",
      "‚úÖ ŸÖÿ±ÿ©: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.\nüçΩ ÿ®ÿπÿ∂ ÿßŸÑÿ¨ÿ±ÿπÿßÿ™ ŸÑÿßÿ≤ŸÖ ŸÖÿπ ÿßŸÑÿ∑ÿπÿßŸÖ (ÿßÿ™ÿ®ÿπ ÿßŸÑŸàÿµŸÅÿ©).",
      chips([{l:"warn",ar:"ÿ±ÿßŸÇÿ® ÿßŸÑŸÜÿ≤ŸäŸÅ",en:"Monitor bleeding"}])
    ),
    entry(["insulin","ÿßŸÜÿ≥ŸàŸÑŸäŸÜ","lantus","novorapid","humalog","mixtard","glargine","aspart"], "Diabetes", "ÿßŸÑÿ≥ŸÉÿ± ‚Äì ÿ•ŸÜÿ≥ŸàŸÑŸäŸÜ",
      "‚ö† Insulin needs an individualized Ramadan plan.\n‚úÖ Mealtime doses with Iftar & Suhoor; basal often evening.\n‚õî Do not change doses without clinician.\nüìå Hypoglycemia symptoms ‚Üí break fast immediately.",
      "‚ö† ÿßŸÑÿ•ŸÜÿ≥ŸàŸÑŸäŸÜ Ÿäÿ≠ÿ™ÿßÿ¨ ÿÆÿ∑ÿ© ŸÅÿ±ÿØŸäÿ© ŸÑÿ±ŸÖÿ∂ÿßŸÜ.\n‚úÖ ÿ¨ÿ±ÿπÿßÿ™ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ ŸÖÿπ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸàÿßŸÑÿ≥ÿ≠Ÿàÿ±ÿõ ÿßŸÑŸÇÿßÿπÿØŸä ÿ∫ÿßŸÑÿ®Ÿãÿß ŸÖÿ≥ÿßÿ°.\n‚õî ŸÑÿß ÿ™ÿ∫ŸäŸëÿ± ÿßŸÑÿ¨ÿ±ÿπÿßÿ™ ÿ®ÿØŸàŸÜ ÿßŸÑÿ∑ÿ®Ÿäÿ®.\nüìå ÿ£ÿπÿ±ÿßÿ∂ Ÿáÿ®Ÿàÿ∑ ÿßŸÑÿ≥ŸÉÿ± ‚Üí ÿßŸÅÿ∑ÿ± ŸÅŸàÿ±Ÿãÿß.",
      chips([{l:"danger",ar:"ÿÆÿ∑ÿ± Ÿáÿ®Ÿàÿ∑ ÿ≥ŸÉÿ± ÿ£ÿπŸÑŸâ",en:"Higher hypoglycemia risk"}])
    ),
    entry(["levothyroxine","euthyrox","eltroxin","ŸÑŸäŸÅŸàÿ´Ÿäÿ±ŸàŸÉÿ≥ŸäŸÜ","ÿ´Ÿäÿ±ŸàŸÉÿ≥ŸäŸÜ"], "Endocrine", "ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ©",
      "‚úÖ Take 30‚Äì60 min before Suhoor on empty stomach with water.\nSeparate 4 hours from iron/calcium/antacids.",
      "‚úÖ ÿÆÿ∞Ÿá ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ± 30‚Äì60 ÿØŸÇŸäŸÇÿ© ÿπŸÑŸâ ŸÖÿπÿØÿ© ŸÅÿßÿ±ÿ∫ÿ© ŸÖÿπ ŸÖÿßÿ°.\nÿßŸÅÿµŸÑ 4 ÿ≥ÿßÿπÿßÿ™ ÿπŸÜ ÿßŸÑÿ≠ÿØŸäÿØ/ÿßŸÑŸÉÿßŸÑÿ≥ŸäŸàŸÖ/ŸÖÿ∂ÿßÿØÿßÿ™ ÿßŸÑÿ≠ŸÖŸàÿ∂ÿ©.",
      chips([{l:"ok",ar:"ÿπŸÑŸâ ŸÖÿπÿØÿ© ŸÅÿßÿ±ÿ∫ÿ©",en:"Empty stomach"}])
    ),
    entry(["omeprazole","pantoprazole","esomeprazole","lansoprazole","ppi","ÿ£ŸàŸÖŸäÿ®ÿ±ÿßÿ≤ŸàŸÑ","ÿ®ÿßŸÜÿ™Ÿàÿ®ÿ±ÿßÿ≤ŸàŸÑ","ÿ•Ÿäÿ≤ŸàŸÖŸäÿ®ÿ±ÿßÿ≤ŸàŸÑ"], "GI (PPI)", "ÿ£ÿØŸàŸäÿ© ÿßŸÑŸÖÿπÿØÿ© (PPI)",
      "‚úÖ Best 30‚Äì60 min before Iftar.\nAlternative: before Suhoor.\nIf BID: before Iftar + before Suhoor.",
      "‚úÖ ÿßŸÑÿ£ŸÅÿ∂ŸÑ ŸÇÿ®ŸÑ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± 30‚Äì60 ÿØŸÇŸäŸÇÿ©.\nÿ®ÿØŸäŸÑ: ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ±.\nÿ•ÿ∞ÿß ŸÖÿ±ÿ™ŸäŸÜ: ŸÇÿ®ŸÑ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ±.",
      chips([{l:"ok",ar:"ŸÇÿ®ŸÑ ÿßŸÑÿ£ŸÉŸÑ ÿ£ŸÅÿ∂ŸÑ",en:"Best before meals"}])
    ),
    entry(["furosemide","lasix","ŸÅÿ±Ÿàÿ≥ŸäŸÖÿßŸäÿØ","ŸÑÿßÿ≤ŸäŸÉÿ≥","hct","hydrochlorothiazide"], "Diuretic", "ŸÖÿØÿ± ÿ®ŸàŸÑ",
      "‚úÖ Best early after Iftar (avoid night urination).\nüíß Watch dehydration; check BP.",
      "‚úÖ ÿßŸÑÿ£ŸÅÿ∂ŸÑ ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸÖÿ®ŸÉÿ±Ÿãÿß (ŸÑÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ™ÿ®ŸàŸÑ ŸÑŸäŸÑŸãÿß).\nüíß ÿßŸÜÿ™ÿ®Ÿá ŸÑŸÑÿ¨ŸÅÿßŸÅ Ÿàÿ±ÿßŸÇÿ® ÿßŸÑÿ∂ÿ∫ÿ∑.",
      chips([{l:"warn",ar:"ÿÆÿ∑ÿ± ÿßŸÑÿ¨ŸÅÿßŸÅ",en:"Dehydration risk"}])
    ),
    entry(["metformin","glucophage","ŸÖŸäÿ™ŸÅŸàÿ±ŸÖŸäŸÜ","ÿ¨ŸÑŸàŸÉŸàŸÅÿßÿ¨"], "Diabetes", "ÿßŸÑÿ≥ŸÉÿ± ‚Äì ŸÖŸäÿ™ŸÅŸàÿ±ŸÖŸäŸÜ",
      "‚úÖ BID: after Iftar + after Suhoor (with food).\n‚úÖ XR OD: after Iftar.",
      "‚úÖ ŸÖÿ±ÿ™ŸäŸÜ: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ÿ®ÿπÿØ ÿßŸÑÿ≥ÿ≠Ÿàÿ± (ŸÖÿπ ÿßŸÑÿ∑ÿπÿßŸÖ).\n‚úÖ ŸÖŸÖÿ™ÿØ OD: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.",
      chips([{l:"warn",ar:"ŸÖÿ±ÿ∂ ÿ≠ÿßÿØ/ÿ¨ŸÅÿßŸÅ ‚Üí ÿ±ÿßÿ¨ÿπ",en:"Acute illness/dehydration ‚Üí seek advice"}])
    ),
    entry(["gliclazide","glimepiride","ÿ≥ŸÑŸÅŸàŸÜŸäŸÑ","ÿ∫ŸÑŸäŸÉŸÑÿßÿ≤ÿßŸäÿØ","glibenclamide"], "Diabetes (Sulfonylurea)", "ÿßŸÑÿ≥ŸÉÿ± ‚Äì ÿ≥ŸÑŸÅŸàŸÜŸäŸÑ ŸäŸàÿ±Ÿäÿß",
      "‚ö† Higher hypoglycemia risk. Usually take with Iftar meal.\n‚õî Dose changes require clinician.",
      "‚ö† ÿÆÿ∑ÿ± Ÿáÿ®Ÿàÿ∑ ÿ≥ŸÉÿ± ÿ£ÿπŸÑŸâ. ÿ∫ÿßŸÑÿ®Ÿãÿß ŸÖÿπ Ÿàÿ¨ÿ®ÿ© ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.\n‚õî ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ¨ÿ±ÿπÿ© Ÿäÿ™ÿ∑ŸÑÿ® ÿßŸÑÿ∑ÿ®Ÿäÿ®.",
      chips([{l:"danger",ar:"ÿÆÿ∑ÿ± Ÿáÿ®Ÿàÿ∑ ÿ≥ŸÉÿ±",en:"Higher hypoglycemia risk"}])
    ),
    entry(["empagliflozin","dapagliflozin","sglt2","ÿ¨ÿßÿ±ÿØŸäŸÜÿ≥","ÿ•ŸÖÿ®ÿßÿ∫ŸÑŸäŸÅŸÑŸàÿ≤ŸäŸÜ","ÿØÿßÿ®ÿßÿ∫ŸÑŸäŸÅŸÑŸàÿ≤ŸäŸÜ"], "Diabetes (SGLT2)", "ÿßŸÑÿ≥ŸÉÿ± ‚Äì SGLT2",
      "‚úÖ OD after Iftar.\nüíß Hydration is important.\n‚ö† Hold during acute illness per plan.",
      "‚úÖ ŸÖÿ±ÿ© ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.\nüíß ÿßŸÑÿ™ÿ±ÿ∑Ÿäÿ® ŸÖŸáŸÖ.\n‚ö† ÿ£ŸàŸÇŸÅ ÿπŸÜÿØ ŸÖÿ±ÿ∂ ÿ≠ÿßÿØ ÿ≠ÿ≥ÿ® ÿßŸÑÿÆÿ∑ÿ©.",
      chips([{l:"warn",ar:"ÿ¨ŸÅÿßŸÅ/ÿßŸÑÿ™Ÿáÿßÿ® ÿ®ŸàŸÑŸä",en:"Dehydration/UTI risk"}])
    ),
    entry(["augmentin","amoxicillin","amoxiclav","ÿ£Ÿàÿ¨ŸÖŸÜÿ™ŸäŸÜ","ÿ£ŸÖŸàŸÉÿ≥Ÿäÿ≥ŸäŸÑŸäŸÜ","ÿ£ŸÖŸàŸÉÿ≥ŸäŸÉŸÑÿßŸÅ"], "Antibiotic", "ŸÖÿ∂ÿßÿØ ÿ≠ŸäŸàŸä",
      "‚úÖ BID: after Iftar + after Suhoor.\nüìå Finish the course.",
      "‚úÖ ŸÖÿ±ÿ™ŸäŸÜ: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ÿ®ÿπÿØ ÿßŸÑÿ≥ÿ≠Ÿàÿ±.\nüìå ÿ£ŸÉŸÖŸÑ ÿßŸÑŸÉŸàÿ±ÿ≥.",
      chips([{l:"warn",ar:"ŸÇÿØ Ÿäÿ§ÿ´ÿ± ÿπŸÑŸâ INR ŸÖÿπ Ÿàÿßÿ±ŸÅÿßÿ±ŸäŸÜ",en:"May affect INR with warfarin"}])
    ),
  ];

  const CLASS_RULES = [
    classRule(["antibiotic","ŸÖÿ∂ÿßÿØ ÿ≠ŸäŸàŸä"], "Antibiotic", "ŸÖÿ∂ÿßÿØ ÿ≠ŸäŸàŸä",
      "If BID: after Iftar + after Suhoor.\nIf OD: after Iftar.\nIf TID/QID: ask clinician for BID/XR alternative.",
      "ÿ•ÿ∞ÿß BID: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ÿ®ÿπÿØ ÿßŸÑÿ≥ÿ≠Ÿàÿ±.\nÿ•ÿ∞ÿß OD: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ±.\nÿ•ÿ∞ÿß TID/QID: ÿßÿ≥ÿ™ÿ¥ÿ± ÿßŸÑÿ∑ÿ®Ÿäÿ® ŸÑÿ®ÿØŸäŸÑ BID/XR.",
      chips([{l:"warn",ar:"ÿ£ŸÉŸÖŸÑ ÿßŸÑŸÉŸàÿ±ÿ≥",en:"Finish the course"}])
    ),
    classRule(["blood pressure","antihypertensive","ÿ∂ÿ∫ÿ∑"], "Blood pressure meds", "ÿ£ÿØŸàŸäÿ© ÿßŸÑÿ∂ÿ∫ÿ∑",
      "OD: after Iftar OR after Suhoor (consistent).\nDiuretics: early after Iftar.",
      "OD: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ÿ£Ÿà ÿßŸÑÿ≥ÿ≠Ÿàÿ± (ŸàŸÇÿ™ ÿ´ÿßÿ®ÿ™).\nÿßŸÑŸÖÿØÿ±ÿßÿ™: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸÖÿ®ŸÉÿ±Ÿãÿß.",
      chips([{l:"warn",ar:"ÿ±ÿßŸÇÿ® ÿßŸÑÿØŸàÿÆÿ©/ÿßŸÑÿ∂ÿ∫ÿ∑",en:"Monitor dizziness/BP"}])
    ),
    classRule(["ppi","ŸÖÿπÿØÿ©","ÿßÿ±ÿ™ÿ¨ÿßÿπ"], "PPI", "ÿ£ÿØŸàŸäÿ© ÿßŸÑŸÖÿπÿØÿ© (PPI)",
      "30‚Äì60 min before Iftar (best). If BID: before Iftar + before Suhoor.",
      "ŸÇÿ®ŸÑ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± 30‚Äì60 ÿØŸÇŸäŸÇÿ© (ÿßŸÑÿ£ŸÅÿ∂ŸÑ). ÿ•ÿ∞ÿß ŸÖÿ±ÿ™ŸäŸÜ: ŸÇÿ®ŸÑ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± + ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ±.",
      chips([{l:"ok",ar:"ŸÇÿ®ŸÑ ÿßŸÑÿ£ŸÉŸÑ ÿ£ŸÅÿ∂ŸÑ",en:"Best before meals"}])
    ),
    classRule(["thyroid","levothyroxine","ÿ∫ÿØÿ©","ÿ´Ÿäÿ±ŸàŸÉÿ≥ŸäŸÜ"], "Thyroid", "ÿßŸÑÿ∫ÿØÿ© ÿßŸÑÿØÿ±ŸÇŸäÿ©",
      "Empty stomach before Suhoor 30‚Äì60 min; separate from iron/calcium/antacids.",
      "ŸÖÿπÿØÿ© ŸÅÿßÿ±ÿ∫ÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ± 30‚Äì60 ÿØŸÇŸäŸÇÿ©ÿõ ÿßŸÅÿµŸÑ ÿπŸÜ ÿßŸÑÿ≠ÿØŸäÿØ/ÿßŸÑŸÉÿßŸÑÿ≥ŸäŸàŸÖ/ŸÖÿ∂ÿßÿØÿßÿ™ ÿßŸÑÿ≠ŸÖŸàÿ∂ÿ©.",
      chips([{l:"ok",ar:"ÿπŸÑŸâ ŸÖÿπÿØÿ© ŸÅÿßÿ±ÿ∫ÿ©",en:"Empty stomach"}])
    ),
    classRule(["inhaler","asthma","ÿ®ÿÆÿßÿÆ"], "Inhalers", "ÿ®ÿÆÿßÿÆÿßÿ™",
      "Continue as prescribed. Do not delay treatment if severe symptoms.",
      "ÿßÿ≥ÿ™ŸÖÿ± ÿ≠ÿ≥ÿ® ÿßŸÑŸàÿµŸÅÿ©. ŸÑÿß ÿ™ÿ§ÿÆÿ± ÿßŸÑÿπŸÑÿßÿ¨ ÿ•ÿ∞ÿß ÿßŸÑÿ£ÿπÿ±ÿßÿ∂ ÿ¥ÿØŸäÿØÿ©.",
      chips([{l:"warn",ar:"ÿßŸÑÿ£ŸàŸÑŸàŸäÿ© ŸÑŸÑÿ£ŸÖÿßŸÜ",en:"Safety first"}])
    ),
    classRule(["pain","analgesic","ŸÖÿ≥ŸÉŸÜ"], "Pain relief", "ŸÖÿ≥ŸÉŸÜÿßÿ™",
      "Paracetamol: between Iftar‚ÄìSuhoor as needed.\nNSAIDs: after Iftar with food; avoid with ulcers/CKD/warfarin unless advised.",
      "ÿ®ÿßÿ±ÿßÿ≥Ÿäÿ™ÿßŸÖŸàŸÑ: ÿ®ŸäŸÜ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸàÿßŸÑÿ≥ÿ≠Ÿàÿ± ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©.\nNSAIDs: ÿ®ÿπÿØ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± ŸÖÿπ ÿßŸÑÿ∑ÿπÿßŸÖÿõ ÿ™ÿ¨ŸÜÿ®Ÿá ŸÖÿπ ŸÇÿ±ÿ≠ÿ©/ŸÉŸÑŸâ/Ÿàÿßÿ±ŸÅÿßÿ±ŸäŸÜ ÿ•ŸÑÿß ÿ®ÿ™Ÿàÿ¨ŸäŸá.",
      chips([{l:"warn",ar:"ŸÖÿπ ÿßŸÑÿ∑ÿπÿßŸÖ",en:"With food"}])
    ),
  ];

  let state = { pending: null };

  function findMed(q){
    const qq = normalize(q);
    if(!qq) return null;
    for(const m of MEDS){
      if(m.keys.some(k => qq===k)) return m;
    }
    for(const m of MEDS){
      if(m.keys.some(k => k.includes(qq) || qq.includes(k))) return m;
    }
    return null;
  }
  function findClass(q){
    const qq = normalize(q);
    if(!qq) return null;
    for(const c of CLASS_RULES){
      if(c.keys.some(k => qq.includes(k) || k.includes(qq))) return c;
    }
    return null;
  }

  function askFrequency(classHint=null){
    state.pending = {type:"freq", classHint};
    pushMsg(t(
      "To cover ALL medications safely, tell me the dosing frequency:
1) Once daily (OD)
2) Twice daily (BID)
3) Three times daily (TID)
4) Four times daily (QID)

Reply: 1 / 2 / 3 / 4",
      "ŸÑÿ™ÿ∫ÿ∑Ÿäÿ© ŸÉŸÑ ÿßŸÑÿ£ÿØŸàŸäÿ© ÿ®ÿ£ŸÖÿßŸÜÿå ÿ≠ÿØŸëÿØ ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ™ ÿ®ÿßŸÑŸäŸàŸÖ:
1) ŸÖÿ±ÿ© ŸäŸàŸÖŸäŸãÿß (OD)
2) ŸÖÿ±ÿ™ŸäŸÜ (BID)
3) ÿ´ŸÑÿßÿ´ ŸÖÿ±ÿßÿ™ (TID)
4) ÿ£ÿ±ÿ®ÿπ ŸÖÿ±ÿßÿ™ (QID)

ÿßŸÉÿ™ÿ®: 1 ÿ£Ÿà 2 ÿ£Ÿà 3 ÿ£Ÿà 4"
    ), "bot", chips([{l:"ok",ar:"ŸÖŸÜÿ∑ŸÇ ÿ¥ÿßŸÖŸÑ ŸÑŸÉŸÑ ÿßŸÑÿ£ÿØŸàŸäÿ©",en:"Scalable for all meds"}]));
  }

  function renderMed(m){
    const header = t(`üìå Category: ${m.cat.en}
`, `üìå ÿßŸÑÿ™ÿµŸÜŸäŸÅ: ${m.cat.ar}
`);
    const body = (ui.mode.value==="hcp" && m.hcp)
      ? t("üßë‚Äç‚öïÔ∏è For HCP:
" + m.hcp.en, "üßë‚Äç‚öïÔ∏è ŸÑŸÑŸÉŸàÿßÿØÿ± ÿßŸÑÿµÿ≠Ÿäÿ©:
" + m.hcp.ar)
      : t(m.patient.ar, m.patient.en);
    pushMsg(header + "
" + body, "bot", m.chips || []);
  }

  function renderClass(c){
    const header = t(`üìå Class: ${c.cat.en}
`, `üìå ÿßŸÑŸÅÿ¶ÿ©: ${c.cat.ar}
`);
    pushMsg(header + "
" + t(c.patient.ar, c.patient.en), "bot", c.chips || []);
    pushMsg(t(
      "If you know the frequency (OD/BID/TID/QID), type it now (1/2/3/4) for the perfect Ramadan schedule.",
      "ÿ•ÿ∞ÿß ÿ™ÿπÿ±ŸÅ ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ™ (OD/BID/TID/QID)ÿå ÿßŸÉÿ™ÿ® ÿßŸÑÿ¢ŸÜ (1/2/3/4) ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ£ÿØŸÇ."
    ), "bot");
    state.pending = {type:"freq", classHint:c.cat};
  }

  function handleFrequencyReply(q){
    const qq = normalize(q);
    const map = {
      "1":"od","od":"od","once":"od","ŸÖÿ±ÿ©":"od",
      "2":"bid","bid":"bid","twice":"bid","ŸÖÿ±ÿ™ŸäŸÜ":"bid",
      "3":"tid","tid":"tid","three":"tid","ÿ´ŸÑÿßÿ´":"tid",
      "4":"qid","qid":"qid","four":"qid","ÿ£ÿ±ÿ®ÿπ":"qid"
    };
    const f = map[qq];
    if(!f){
      pushMsg(t("Please reply 1/2/3/4 (OD/BID/TID/QID).","ÿßŸÉÿ™ÿ® 1/2/3/4 (OD/BID/TID/QID)."),"bot");
      return;
    }
    const g = freqGuidance(f);
    const label = (state.pending && state.pending.classHint)
      ? t(`üìå Based on class: ${state.pending.classHint.en || ""}
`, `üìå ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÅÿ¶ÿ©: ${state.pending.classHint.ar || ""}
`)
      : "";
    pushMsg(label + "
" + t(g.ar,g.en), "bot", g.chips||[]);
    state.pending = null;
  }

  function route(q){
    if(state.pending && state.pending.type==="freq"){
      handleFrequencyReply(q);
      return;
    }

    const qq = normalize(q);
    if(!qq) return;

    const m = findMed(q);
    if(m){ renderMed(m); return; }

    const c = findClass(q);
    if(c){ renderClass(c); return; }

    pushMsg(t(
      "I couldn't find that exact medication.
‚úÖ Type a class (antibiotic / PPI / blood pressure / inhaler / pain), or reply with frequency (1/2/3/4) to generate a safe Ramadan schedule for ANY medication.",
      "ŸÑŸÖ ÿ£ÿ¨ÿØ ÿßŸÑÿØŸàÿßÿ° ÿ®ÿßŸÑÿßÿ≥ŸÖ.
‚úÖ ÿßŸÉÿ™ÿ® ŸÅÿ¶ÿ© ÿßŸÑÿØŸàÿßÿ° (ŸÖÿ∂ÿßÿØ ÿ≠ŸäŸàŸä / PPI / ÿ∂ÿ∫ÿ∑ / ÿ®ÿÆÿßÿÆ / ŸÖÿ≥ŸÉŸÜ)ÿå ÿ£Ÿà ÿßŸÉÿ™ÿ® ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ™ (1/2/3/4) ŸÑÿ£ÿπÿ∑ŸäŸÉ ÿ¨ÿØŸàŸÑ ÿ¢ŸÖŸÜ ŸÑÿ£Ÿä ÿØŸàÿßÿ°."
    ),"bot");
    askFrequency();
  }

  const quick = [
    "warfarin","insulin","levothyroxine","omeprazole","metformin","augmentin",
    "antibiotic","blood pressure","PPI","inhaler","pain",
    "OD (1)","BID (2)","TID (3)","QID (4)"
  ];
  function buildQuick(){
    ui.quick.innerHTML = "";
    quick.forEach(label=>{
      const b = document.createElement("div");
      b.className = "pill";
      b.textContent = label;
      b.onclick = ()=>{
        let v = label;
        if(label==="OD (1)") v="1";
        if(label==="BID (2)") v="2";
        if(label==="TID (3)") v="3";
        if(label==="QID (4)") v="4";
        pushMsg(v,"me");
        route(v);
      };
      ui.quick.appendChild(b);
    });
  }

  function welcome(){
    ui.chat.innerHTML = "";
    state.pending = null;
    pushMsg(t(
      "Ramadan Kareem üåô

Welcome to QCH Smart Ramadan Medication Assistant.
Type your medication name (Arabic/English). If not found, type a class or reply with dosing frequency (1/2/3/4).

Example: warfarin / insulin / omeprazole / antibiotic / blood pressure",
      "Ramadan Kareem üåô

ÿ£ŸáŸÑŸãÿß ÿ®ŸÉ ŸÅŸä ŸÖÿ≥ÿßÿπÿØ ÿ£ÿØŸàŸäÿ© ÿ±ŸÖÿ∂ÿßŸÜ ‚Äì ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ÿßŸÑŸÇÿ∑ŸäŸÅ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿä.
ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ÿßŸÑÿØŸàÿßÿ° (ÿπÿ±ÿ®Ÿä/ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä). ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ∏Ÿáÿ±ÿå ÿßŸÉÿ™ÿ® ŸÅÿ¶ÿ© ÿßŸÑÿØŸàÿßÿ° ÿ£Ÿà ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ™ (1/2/3/4).

ŸÖÿ´ÿßŸÑ: Ÿàÿßÿ±ŸÅÿßÿ±ŸäŸÜ / ÿßŸÜÿ≥ŸàŸÑŸäŸÜ / omeprazole / ŸÖÿ∂ÿßÿØ ÿ≠ŸäŸàŸä / ÿ∂ÿ∫ÿ∑"
    ), "bot");

    ui.welcomeBox.textContent = t(
      "Perfect Ramadan guidance = (Medication OR Class) + (Frequency).
If your medicine is TID/QID, ask for XR/BID alternative.",
      "ÿßŸÑÿ•ÿ±ÿ¥ÿßÿØ ÿßŸÑŸÖÿ´ÿßŸÑŸä = (ÿßÿ≥ŸÖ ÿßŸÑÿØŸàÿßÿ° ÿ£Ÿà ÿßŸÑŸÅÿ¶ÿ©) + (ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ™).
ÿ•ÿ∞ÿß TID/QID ÿßÿ∑ŸÑÿ® ÿ®ÿØŸäŸÑ XR/BID."
    );
  }

  function send(){
    const q = ui.input.value;
    if(!q.trim()) return;
    pushMsg(q,"me");
    ui.input.value = "";
    route(q);
  }

  ui.send.addEventListener("click", send);
  ui.input.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); send(); } });
  ui.reset.addEventListener("click", welcome);
  ui.lang.addEventListener("change", welcome);
  ui.mode.addEventListener("change", welcome);

  buildQuick();
  welcome();
})();
</script>
</body>
</html>
